# Story 1.3: View Job Listings

**Status**: Draft

**Story**

As any user,
I want to see a list of available jobs on the platform,
so that I can begin to explore opportunities.

**Acceptance Criteria**

1. The homepage or a dedicated "Jobs" page displays a list of job postings.
2. Each job in the list displays the job title, company name, and location.
3. The backend provides a public (unauthenticated) API endpoint to fetch a paginated list of jobs.
4. The database is seeded with sample job data for development and initial display purposes.

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend JobPosting Entity and Repository (AC: 2, 3)**
  - [ ] Subtask 1.1: Create `JobPosting` entity in `apps/api/src/main/java/com/recruitify/entities/JobPosting.java` with fields: `id`, `recruiterId`, `companyId`, `title`, `description`, `location`, `category`, `salaryMin`, `salaryMax`, `salaryCurrency`, `status`, `createdAt`, `updatedAt`. [Source: Inferred from architecture/4-data-models.md and epic requirements]
  - [ ] Subtask 1.2: Create `JobPostingRepository` interface extending `JpaRepository<JobPosting, UUID>`. [Source: architecture/11-backend-architecture.md#data-access-layer-dal]
  - [ ] Subtask 1.3: Add custom repository method `Page<JobPosting> findByStatus(String status, Pageable pageable)` for fetching active jobs. [Source: architecture/11-backend-architecture.md#data-access-layer-dal]

- [ ] **Task 2: Create Database Schema and Migration for Job Postings (AC: 3, 4)**
  - [ ] Subtask 2.1: Create database migration file for `job_postings` table with all required fields and indexes. [Source: Inferred from architecture/9-database-schema.md patterns]
  - [ ] Subtask 2.2: Create `companies` table (id, name, website, description) if not already created in Story 1.1. [Source: Epic 2.1 requirements]
  - [ ] Subtask 2.3: Add foreign key constraints for `recruiter_id` (references `users`) and `company_id` (references `companies`). [Source: architecture/9-database-schema.md patterns]
  - [ ] Subtask 2.4: Add indexes on `recruiter_id`, `company_id`, `status`, and `created_at` for query optimization. [Source: architecture/9-database-schema.md patterns]

- [ ] **Task 3: Create Database Seed Data for Sample Jobs (AC: 4)**
  - [ ] Subtask 3.1: Create seed data file or script to insert sample company records. [Source: AC 4]
  - [ ] Subtask 3.2: Create seed data file or script to insert 10-15 sample job postings with varied titles, companies, and locations. [Source: AC 4]
  - [ ] Subtask 3.3: Ensure seeded jobs have `status = 'ACTIVE'` and realistic data for testing. [Source: AC 4]
  - [ ] Subtask 3.4: Configure seed data to run automatically during development environment setup. [Source: AC 4]

- [ ] **Task 4: Implement Backend Service for Fetching Jobs (AC: 3)**
  - [ ] Subtask 4.1: Create `JobService` in `apps/api/src/main/java/com/recruitify/service/JobService.java`. [Source: architecture/11-backend-architecture.md#service-architecture]
  - [ ] Subtask 4.2: Implement `getActiveJobs(Pageable pageable)` method that fetches jobs with `status = 'ACTIVE'`. [Source: architecture/11-backend-architecture.md#service-architecture]
  - [ ] Subtask 4.3: Implement pagination logic using Spring's `Pageable` and return `Page<JobPosting>`. [Source: AC 3 - paginated list requirement]
  - [ ] Subtask 4.4: Sort jobs by `createdAt` descending (newest first) by default. [Source: Common UX pattern]

- [ ] **Task 5: Create Backend Job Controller and API Endpoint (AC: 3)**
  - [ ] Subtask 5.1: Create `JobController` in `apps/api/src/main/java/com/recruitify/controller/JobController.java`. [Source: architecture/11-backend-architecture.md#controllerroute-organization]
  - [ ] Subtask 5.2: Implement `GET /api/v1/jobs` endpoint that accepts query params: `page`, `size` (default: page=0, size=20). [Source: architecture/11-backend-architecture.md#controllerroute-organization]
  - [ ] Subtask 5.3: Endpoint should be public (no authentication required). [Source: AC 3 - public endpoint]
  - [ ] Subtask 5.4: Return paginated response with job list and pagination metadata (total pages, total elements, current page). [Source: AC 3]
  - [ ] Subtask 5.5: Map `JobPosting` entities to `JobListingDto` (excluding sensitive fields like `recruiterId`). [Source: Security best practice]

- [ ] **Task 6: Create Shared TypeScript Types for Jobs (AC: 1, 2)**
  - [ ] Subtask 6.1: Create `packages/shared-types/job.ts` with `JobListing` interface. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
  - [ ] Subtask 6.2: Define `JobListing` interface with fields: `id`, `title`, `companyName`, `location`, `category`, `salaryMin`, `salaryMax`, `salaryCurrency`, `createdAt`. [Source: AC 2 and epic requirements]
  - [ ] Subtask 6.3: Create `PaginatedResponse<T>` generic interface for paginated API responses. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]

- [ ] **Task 7: Create Frontend Job Service Layer (AC: 1, 3)**
  - [ ] Subtask 7.1: Create `apps/web/src/services/jobService.ts` that uses the centralized `apiClient`. [Source: architecture/10-frontend-architecture.md#api-client-setup]
  - [ ] Subtask 7.2: Implement `getJobs(page: number, size: number)` function that calls `GET /api/v1/jobs`. [Source: architecture/10-frontend-architecture.md#service-example]
  - [ ] Subtask 7.3: Function should return `PaginatedResponse<JobListing>`. [Source: architecture/10-frontend-architecture.md#service-example]

- [ ] **Task 8: Create Frontend Job Store with Zustand (AC: 1)**
  - [ ] Subtask 8.1: Create `apps/web/src/stores/useJobsStore.ts` to manage job listings state. [Source: architecture/10-frontend-architecture.md#state-structure]
  - [ ] Subtask 8.2: Store `jobs` array, `currentPage`, `totalPages`, `isLoading`, and `error`. [Source: architecture/10-frontend-architecture.md#state-management-patterns]
  - [ ] Subtask 8.3: Create async action `fetchJobs(page: number)` that calls `jobService.getJobs()` and updates store. [Source: architecture/10-frontend-architecture.md#state-management-patterns]

- [ ] **Task 9: Create Frontend Job List Components (AC: 1, 2)**
  - [ ] Subtask 9.1: Create `apps/web/src/features/jobs/JobListingCard.tsx` component to display a single job. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 9.2: `JobListingCard` should display: job title, company name, location using Ant Design `Card` component. [Source: AC 2 and architecture/3-tech-stack.md]
  - [ ] Subtask 9.3: Create `apps/web/src/features/jobs/JobListingGrid.tsx` component to display a list of `JobListingCard` components. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 9.4: `JobListingGrid` should use Ant Design `List` or `Row`/`Col` for responsive grid layout. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 9.5: Add loading state using Ant Design `Skeleton` or `Spin` component. [Source: UX best practice]
  - [ ] Subtask 9.6: Add empty state when no jobs are available. [Source: UX best practice]

- [ ] **Task 10: Create Frontend Jobs Page with Pagination (AC: 1, 3)**
  - [ ] Subtask 10.1: Create `apps/web/src/pages/jobs/index.tsx` route for `/jobs`. [Source: architecture/10-frontend-architecture.md#route-organization]
  - [ ] Subtask 10.2: Use `useJobsStore` to fetch and display jobs on component mount. [Source: architecture/10-frontend-architecture.md#state-management-patterns]
  - [ ] Subtask 10.3: Pass job data from store to `JobListingGrid` component. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 10.4: Add Ant Design `Pagination` component at the bottom of the job list. [Source: AC 3 - paginated list]
  - [ ] Subtask 10.5: Handle pagination changes by calling `fetchJobs(newPage)` from the store. [Source: AC 3]

- [ ] **Task 11: Update Homepage to Display Job Listings (AC: 1)**
  - [ ] Subtask 11.1: Update `apps/web/src/pages/index.tsx` (homepage) to include a job listings section. [Source: AC 1 - homepage or dedicated page]
  - [ ] Subtask 11.2: Display first 6-10 jobs from `useJobsStore` on the homepage. [Source: AC 1]
  - [ ] Subtask 11.3: Add "View All Jobs" link/button that navigates to `/jobs` page. [Source: UX best practice]

- [ ] **Task 12: Implement Backend Unit Tests (AC: 3)**
  - [ ] Subtask 12.1: Write unit test for `JobService.getActiveJobs()` to verify it fetches only active jobs. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 12.2: Write unit test for `JobService.getActiveJobs()` to verify pagination logic. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 12.3: Place tests in `apps/api/src/test/java/com/recruitify/service/JobServiceTest.java`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 13: Implement Backend Integration Tests (AC: 3)**
  - [ ] Subtask 13.1: Write integration test for `GET /api/v1/jobs` endpoint (full request/response cycle). [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 13.2: Verify endpoint is publicly accessible (no authentication required). [Source: AC 3]
  - [ ] Subtask 13.3: Verify pagination query params work correctly. [Source: AC 3]
  - [ ] Subtask 13.4: Verify response includes correct pagination metadata. [Source: AC 3]
  - [ ] Subtask 13.5: Place tests in `apps/api/src/test/java/com/recruitify/controller/JobControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 14: Implement Frontend Component Tests (AC: 1, 2)**
  - [ ] Subtask 14.1: Write unit test for `JobListingCard` to verify it renders job title, company name, and location correctly. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 14.2: Write unit test for `JobListingGrid` to verify it renders multiple job cards. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 14.3: Place tests co-located: `JobListingCard.test.tsx` and `JobListingGrid.test.tsx`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 15: Implement E2E Tests (AC: 1, 2, 3)**
  - [ ] Subtask 15.1: Create Playwright E2E test to navigate to `/jobs` page and verify job listings are displayed. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 15.2: Verify each job card displays title, company name, and location. [Source: AC 2]
  - [ ] Subtask 15.3: Verify pagination controls work correctly (navigate to next/previous page). [Source: AC 3]
  - [ ] Subtask 15.4: Verify homepage displays job listings and "View All Jobs" link works. [Source: AC 1]
  - [ ] Subtask 15.5: Place tests in `e2e/jobs.spec.ts`. [Source: architecture/16-testing-strategy.md#test-organization]

**Dev Notes**

**Previous Story Insights**: Story 1.1 (Project & Infrastructure Setup) is still in Draft status. This story assumes that the foundational infrastructure (monorepo, PostgreSQL database, basic CI/CD) from Story 1.1 has been completed. The database must be ready to accept new migrations for job-related tables.

**Important Architectural Gap**: The `JobPosting` data model is **referenced but not fully defined** in the architecture documents (architecture/4-data-models.md). The architecture mentions that "A User with the RECRUITER role has many JobPostings" but does not provide the complete field definition. The Dev Agent should use the inferred model structure provided in these Dev Notes.

**Data Models**:

*   **JobPosting Model (Inferred from Epic Requirements)**:
    *   `id`: `string` (UUID) - Primary key
    *   `recruiterId`: `string` (UUID, FK to User) - The recruiter who posted the job
    *   `companyId`: `string` (UUID, FK to Company) - The company posting the job
    *   `title`: `string` - Job title (e.g., "Senior Software Engineer")
    *   `description`: `string` - Full job description
    *   `location`: `string` - Job location (e.g., "San Francisco, CA")
    *   `category`: `string` - Job category/type (e.g., "Engineering", "Marketing")
    *   `salaryMin`: `number` - Minimum salary (optional)
    *   `salaryMax`: `number` - Maximum salary (optional)
    *   `salaryCurrency`: `string` - Currency code (e.g., "USD", default)
    *   `status`: `'ACTIVE' | 'INACTIVE' | 'CLOSED'` - Job posting status (default: ACTIVE)
    *   `createdAt`: `Date` - When job was posted
    *   `updatedAt`: `Date` - Last modification timestamp
    *   [Source: Inferred from architecture/4-data-models.md patterns and Epic 2.2 requirements]

*   **Company Model (Basic, for this story)**:
    *   `id`: `string` (UUID) - Primary key
    *   `name`: `string` - Company name
    *   `website`: `string` - Company website URL
    *   `description`: `string` - Company description
    *   [Source: Inferred from Epic 2.1 requirements]

*   **Relationships**:
    *   `JobPosting` belongs to one `User` (recruiter)
    *   `JobPosting` belongs to one `Company`
    *   [Source: architecture/4-data-models.md#model-user]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/job.ts
export interface JobListing {
  id: string;
  title: string;
  companyName: string;  // Denormalized for display
  location: string;
  category: string;
  salaryMin?: number;
  salaryMax?: number;
  salaryCurrency?: string;
  createdAt: Date;
}

export interface PaginatedResponse<T> {
  content: T[];
  totalPages: number;
  totalElements: number;
  currentPage: number;
  pageSize: number;
}
```

**API Specifications**:

*   Server URL: `/api/v1`. [Source: architecture/5-api-specification.md#rest-api-specification-openapi-30]
*   **GET /api/v1/jobs**: Fetches paginated list of active jobs. Query params: `page` (default: 0), `size` (default: 20). Returns `PaginatedResponse<JobListing>` with 200 OK. This endpoint is **public** (no authentication required). [Source: AC 3 and architecture/11-backend-architecture.md patterns]
*   Response format should include both job data and pagination metadata:
    ```json
    {
      "content": [...jobs],
      "totalPages": 5,
      "totalElements": 87,
      "currentPage": 0,
      "pageSize": 20
    }
    ```

**Database Schema**:

```sql
-- Companies table (basic structure for this story)
CREATE TABLE companies (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    website VARCHAR(255),
    description TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Job postings table
CREATE TABLE job_postings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    recruiter_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    location VARCHAR(255) NOT NULL,
    category VARCHAR(100),
    salary_min DECIMAL(10, 2),
    salary_max DECIMAL(10, 2),
    salary_currency VARCHAR(3) DEFAULT 'USD',
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'INACTIVE', 'CLOSED')),
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX idx_job_postings_recruiter ON job_postings (recruiter_id);
CREATE INDEX idx_job_postings_company ON job_postings (company_id);
CREATE INDEX idx_job_postings_status ON job_postings (status);
CREATE INDEX idx_job_postings_created_at ON job_postings (created_at DESC);
```
[Source: Inferred from architecture/9-database-schema.md patterns]

**Component Specifications**:

*   **JobListingCard**: Displays a single job posting with title, company name, and location. Should use Ant Design's `Card` component with clean, readable layout. [Source: architecture/10-frontend-architecture.md#component-organization and architecture/3-tech-stack.md]
*   **JobListingGrid**: Displays a grid of `JobListingCard` components. Should use Ant Design's `List` or responsive `Row`/`Col` grid. Must handle loading and empty states. [Source: architecture/10-frontend-architecture.md#component-organization]

**File Locations**:

*   **Backend**:
    *   Entity: `apps/api/src/main/java/com/recruitify/entities/JobPosting.java`, `Company.java` [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   Repository: `apps/api/src/main/java/com/recruitify/repository/JobPostingRepository.java`, `CompanyRepository.java` [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   Service: `apps/api/src/main/java/com/recruitify/service/JobService.java` [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/JobController.java` [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   DTOs: `apps/api/src/main/java/com/recruitify/dto/JobListingDto.java`
    *   Database Migrations: `apps/api/src/main/resources/db/migration/` (Flyway) or `apps/api/src/main/resources/db/changelog/` (Liquibase)
    *   Seed Data: `apps/api/src/main/resources/data.sql` or similar

*   **Frontend**:
    *   Pages: `apps/web/src/pages/jobs/index.tsx`, `apps/web/src/pages/index.tsx` (homepage) [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   Components: `apps/web/src/features/jobs/JobListingCard.tsx`, `apps/web/src/features/jobs/JobListingGrid.tsx` [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   Services: `apps/web/src/services/jobService.ts` [Source: architecture/12-unified-project-structure.md#project-directory-structure]
    *   Store: `apps/web/src/stores/useJobsStore.ts` [Source: architecture/12-unified-project-structure.md#project-directory-structure]

*   **Shared Types**: `packages/shared-types/job.ts` [Source: architecture/17-coding-standards.md#critical-fullstack-rules]

**Testing Requirements**:

*   **Unit Tests:**
    *   Backend: Use JUnit 5 & Mockito. Tests in `apps/api/src/test/java` mirroring main source structure. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
    *   Frontend: Use Jest & React Testing Library. Tests co-located with components. [Source: architecture/16-testing-strategy.md#test-organization]

*   **Integration Tests:** Backend controller-service-repository tests to verify full API request/response cycle. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]

*   **E2E Tests:** Use Playwright to test user journey of viewing job listings on homepage and `/jobs` page, including pagination. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]

**Technical Constraints**:

*   **Public Endpoint**: `GET /api/v1/jobs` must be publicly accessible (no authentication required). Configure Spring Security to permit all requests to this endpoint. [Source: AC 3]
*   **Pagination**: Use Spring Data's `Pageable` interface for backend pagination. Default page size should be 20. [Source: Common backend practice]
*   **Performance**: Add database indexes on frequently queried columns (`status`, `created_at`, foreign keys). Target response time < 100ms. [Source: architecture/15-security-and-performance.md#backend-performance]
*   **Sorting**: Jobs should be sorted by `createdAt` descending (newest first) by default. [Source: Common UX pattern]
*   **Service Layer Pattern**: Frontend components must NEVER make direct HTTP requests; always use `jobService`. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
*   **Shared Types**: All types shared between frontend and backend MUST be defined in `packages/shared-types`. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
*   **Data Transfer Objects**: Backend should map `JobPosting` entities to `JobListingDto` for API responses, excluding sensitive fields like `recruiterId`. [Source: Security best practice]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `JobListingCard.tsx`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   React hooks: `useCamelCase` (e.g., `useJobsStore.ts`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   Java classes: `PascalCase` (e.g., `JobController.java`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   API endpoints: `kebab-case` (e.g., `/api/v1/jobs`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   Database tables: `snake_case` (e.g., `job_postings`, `companies`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   Database columns: `snake_case` (e.g., `recruiter_id`, `created_at`) [Source: architecture/17-coding-standards.md#naming-conventions]

**Seed Data Requirements**:

*   Create 3-5 sample companies with realistic names and descriptions. [Source: AC 4]
*   Create 10-15 sample job postings with:
    *   Varied job titles (e.g., "Senior Software Engineer", "Product Manager", "UX Designer")
    *   Different companies and locations
    *   Realistic descriptions
    *   Mix of salary ranges (some with, some without)
    *   All jobs should have `status = 'ACTIVE'`
    *   Varied `createdAt` timestamps for testing sorting
*   Seed data should be automatically loaded in development environment. [Source: AC 4]

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 1, Story 1.3 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**