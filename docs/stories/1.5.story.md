# Story 1.5: View Job Details

**Status**: Draft

**Story**

As a job seeker,
I want to click on a job to see its full description,
so that I can evaluate if it's a good fit.

**Acceptance Criteria**

1. Clicking on any job item in the search results list navigates the user to a unique page for that job.
2. The job detail page displays all relevant information, including title, company, location, and the full job description.
3. The backend provides a public API endpoint to fetch a single job by its unique ID.

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend API Endpoint for Single Job Retrieval (AC: 3)**
  - [ ] Subtask 1.1: Add method `Optional<JobPosting> findByIdAndStatus(UUID id, String status)` to `JobPostingRepository`. [Source: architecture/11-backend-architecture.md#data-access-layer-dal]
  - [ ] Subtask 1.2: Create `JobService.getJobById(UUID id)` method that fetches a single active job by ID. [Source: architecture/11-backend-architecture.md#service-architecture]
  - [ ] Subtask 1.3: Method should return empty Optional if job not found or not ACTIVE status. [Source: Security best practice]
  - [ ] Subtask 1.4: Implement `GET /api/v1/jobs/{jobId}` endpoint in `JobController`. [Source: architecture/11-backend-architecture.md#controllerroute-organization]
  - [ ] Subtask 1.5: Endpoint should be public (no authentication required). [Source: AC 3]
  - [ ] Subtask 1.6: Return 200 OK with `JobDetailDto` if found, 404 Not Found if job doesn't exist. [Source: REST best practice]
  - [ ] Subtask 1.7: Map `JobPosting` entity to `JobDetailDto` (including full description, excluding sensitive fields). [Source: Security best practice]

- [ ] **Task 2: Create Shared TypeScript Types for Job Details (AC: 2)**
  - [ ] Subtask 2.1: Create `JobDetail` interface in `packages/shared-types/job.ts` extending `JobListing`. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
  - [ ] Subtask 2.2: Add `description` field (full job description) to `JobDetail` interface. [Source: AC 2]
  - [ ] Subtask 2.3: Add optional fields: `companyWebsite`, `companyDescription` for display on detail page. [Source: Enhanced UX]

- [ ] **Task 3: Create Frontend Job Service Method for Single Job (AC: 3)**
  - [ ] Subtask 3.1: Add `getJobById(jobId: string)` function to `apps/web/src/services/jobService.ts`. [Source: architecture/10-frontend-architecture.md#service-example]
  - [ ] Subtask 3.2: Function should call `GET /api/v1/jobs/{jobId}` and return `JobDetail`. [Source: architecture/10-frontend-architecture.md#api-client-setup]
  - [ ] Subtask 3.3: Handle 404 errors gracefully (job not found scenario). [Source: Error handling best practice]

- [ ] **Task 4: Create Frontend Job Detail Store (AC: 2)**
  - [ ] Subtask 4.1: Create `useJobDetailStore.ts` in `apps/web/src/stores/` to manage single job detail state. [Source: architecture/10-frontend-architecture.md#state-structure]
  - [ ] Subtask 4.2: Store state: `currentJob`, `isLoading`, `error`. [Source: architecture/10-frontend-architecture.md#state-management-patterns]
  - [ ] Subtask 4.3: Create async action `fetchJobDetail(jobId: string)` that calls `jobService.getJobById()`. [Source: architecture/10-frontend-architecture.md#state-management-patterns]
  - [ ] Subtask 4.4: Create action `clearJobDetail()` to reset state when leaving detail page. [Source: Memory management best practice]

- [ ] **Task 5: Create Job Detail Page Component (AC: 1, 2)**
  - [ ] Subtask 5.1: Create `apps/web/src/pages/jobs/[jobId].tsx` dynamic route for job detail page. [Source: architecture/10-frontend-architecture.md#route-organization]
  - [ ] Subtask 5.2: Use Next.js dynamic routing with `useRouter()` to get `jobId` from URL. [Source: architecture/10-frontend-architecture.md#routing-architecture]
  - [ ] Subtask 5.3: Fetch job details using `useJobDetailStore.fetchJobDetail(jobId)` on component mount. [Source: architecture/10-frontend-architecture.md#state-management-patterns]
  - [ ] Subtask 5.4: Display loading state using Ant Design `Skeleton` or `Spin` component. [Source: architecture/3-tech-stack.md and UX best practice]
  - [ ] Subtask 5.5: Display error state (404) when job not found with option to return to job listings. [Source: UX best practice]
  - [ ] Subtask 5.6: Display job details when loaded (see Task 6 for component structure). [Source: AC 2]

- [ ] **Task 6: Create Job Detail Display Components (AC: 2)**
  - [ ] Subtask 6.1: Create `apps/web/src/features/jobs/JobDetailHeader.tsx` component to display job title, company, location. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 6.2: Use Ant Design `Typography` components for proper text hierarchy (Title, Text, Paragraph). [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 6.3: Create `apps/web/src/features/jobs/JobDetailContent.tsx` component to display full job description. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 6.4: Format job description with proper line breaks and styling using Ant Design `Typography.Paragraph`. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 6.5: Create `apps/web/src/features/jobs/JobDetailSidebar.tsx` component for additional info (salary, category, posted date). [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 6.6: Use Ant Design `Descriptions` or `Card` component for sidebar info. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 6.7: Add "Back to Jobs" link/button using Next.js `Link` component. [Source: UX best practice]

- [ ] **Task 7: Update Job Listing Cards to Link to Detail Page (AC: 1)**
  - [ ] Subtask 7.1: Update `JobListingCard.tsx` to wrap card content in Next.js `Link` component. [Source: architecture/10-frontend-architecture.md#routing-architecture]
  - [ ] Subtask 7.2: Link should point to `/jobs/[jobId]` using the job's ID. [Source: AC 1]
  - [ ] Subtask 7.3: Add hover effect to indicate card is clickable (cursor pointer, subtle highlight). [Source: UX best practice]
  - [ ] Subtask 7.4: Ensure link is accessible (proper ARIA labels). [Source: Accessibility best practice]

- [ ] **Task 8: Implement SEO and Metadata for Job Detail Pages (AC: 1, 2)**
  - [ ] Subtask 8.1: Add Next.js `Head` component to job detail page with dynamic title and meta tags. [Source: Next.js best practice]
  - [ ] Subtask 8.2: Set page title to format: "{Job Title} at {Company Name} | Recruitify". [Source: SEO best practice]
  - [ ] Subtask 8.3: Add Open Graph meta tags for social sharing (og:title, og:description, og:url). [Source: SEO best practice]

- [ ] **Task 9: Implement Backend Unit Tests for Single Job Retrieval (AC: 3)**
  - [ ] Subtask 9.1: Write unit test for `JobService.getJobById()` to verify it returns job when found and active. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 9.2: Write unit test for `JobService.getJobById()` to verify it returns empty when job not found. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 9.3: Write unit test for `JobService.getJobById()` to verify it returns empty when job is not ACTIVE. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 9.4: Place tests in `apps/api/src/test/java/com/recruitify/service/JobServiceTest.java`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 10: Implement Backend Integration Tests for Job Detail API (AC: 3)**
  - [ ] Subtask 10.1: Write integration test for `GET /api/v1/jobs/{validJobId}` to verify 200 OK response with correct data. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 10.2: Write integration test for `GET /api/v1/jobs/{invalidJobId}` to verify 404 Not Found response. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 10.3: Verify endpoint is publicly accessible (no authentication required). [Source: AC 3]
  - [ ] Subtask 10.4: Verify response includes full job description. [Source: AC 2]
  - [ ] Subtask 10.5: Place tests in `apps/api/src/test/java/com/recruitify/controller/JobControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 11: Implement Frontend Component Tests for Job Detail (AC: 2)**
  - [ ] Subtask 11.1: Write unit test for `JobDetailHeader` to verify it renders job title, company, and location. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 11.2: Write unit test for `JobDetailContent` to verify it renders full job description. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 11.3: Write unit test for job detail page to verify loading state displays correctly. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 11.4: Write unit test for job detail page to verify 404 error state displays correctly. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 11.5: Place tests co-located with components: `JobDetailHeader.test.tsx`, `JobDetailContent.test.tsx`, `[jobId].test.tsx`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 12: Implement E2E Tests for Job Detail Flow (AC: 1, 2, 3)**
  - [ ] Subtask 12.1: Create Playwright E2E test to navigate to `/jobs` page and click on a job card. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
  - [ ] Subtask 12.2: Verify navigation to job detail page with correct URL format `/jobs/{jobId}`. [Source: AC 1]
  - [ ] Subtask 12.3: Verify job detail page displays job title, company name, location, and full description. [Source: AC 2]
  - [ ] Subtask 12.4: Verify "Back to Jobs" link returns to job listings page. [Source: UX best practice]
  - [ ] Subtask 12.5: Test direct navigation to job detail URL (deep linking). [Source: Web best practice]
  - [ ] Subtask 12.6: Test navigation to non-existent job ID and verify 404 error handling. [Source: Error handling]
  - [ ] Subtask 12.7: Place tests in `e2e/job-details.spec.ts`. [Source: architecture/16-testing-strategy.md#test-organization]

**Dev Notes**

**Previous Story Insights**:

Stories 1.3 and 1.4 established the job listing and search/filter functionality:
- **Story 1.3**: Created `JobPosting` entity, `JobPostingRepository`, `JobService`, `GET /api/v1/jobs` endpoint with pagination, `JobListingCard`, `JobListingGrid`, and `/jobs` page
- **Story 1.4**: Extended with search/filter capabilities (keyword, location, category filters)
- `JobListing` interface exists but contains only summary information (id, title, companyName, location, category, salary, createdAt) - does NOT include full description
- Job listing cards currently display only summary information, not full description

This story adds the ability to view a single job's complete details, including the full description field that was omitted from the listing view.

**Data Models**:

*   **JobPosting Entity (from Story 1.3)**:
    *   `id`: `string` (UUID) - Primary key, used in URL routing
    *   `recruiterId`: `string` (UUID, FK to User)
    *   `companyId`: `string` (UUID, FK to Company)
    *   `title`: `string` - Job title
    *   `description`: `string` - **Full job description (key field for this story)**
    *   `location`: `string` - Job location
    *   `category`: `string` - Job category
    *   `salaryMin`: `number` (optional)
    *   `salaryMax`: `number` (optional)
    *   `salaryCurrency`: `string`
    *   `status`: `'ACTIVE' | 'INACTIVE' | 'CLOSED'` - Only ACTIVE jobs shown
    *   `createdAt`: `Date`
    *   `updatedAt`: `Date`
    *   [Source: Story 1.3 Dev Notes]

*   **Company Model (from Story 1.3)**:
    *   `id`: `string` (UUID)
    *   `name`: `string`
    *   `website`: `string` - Can be displayed on detail page
    *   `description`: `string` - Can be displayed on detail page
    *   [Source: Story 1.3 Dev Notes]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/job.ts (extends Story 1.3)

// Existing from Story 1.3:
export interface JobListing {
  id: string;
  title: string;
  companyName: string;
  location: string;
  category: string;
  salaryMin?: number;
  salaryMax?: number;
  salaryCurrency?: string;
  createdAt: Date;
}

// NEW for Story 1.5:
export interface JobDetail extends JobListing {
  description: string;           // Full job description (main addition)
  companyWebsite?: string;        // Company website URL
  companyDescription?: string;    // Company description
  recruiterId: string;            // May be useful for future features (not displayed to public)
}
```
[Source: architecture/17-coding-standards.md#critical-fullstack-rules]

**API Specifications**:

*   Server URL: `/api/v1`. [Source: architecture/5-api-specification.md#rest-api-specification-openapi-30]

*   **GET /api/v1/jobs/{jobId}**: NEW endpoint to fetch a single job by ID
    *   **Path Parameters**:
        *   `jobId` (UUID, required) - The unique identifier of the job
    *   **Response**:
        *   **200 OK**: Returns `JobDetail` object with full information
        *   **404 Not Found**: Job doesn't exist or is not ACTIVE
    *   **Authentication**: Public endpoint (no auth required) [Source: AC 3]
    *   **Example Response**:
    ```json
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "title": "Senior Software Engineer",
      "companyName": "Recruitify Inc",
      "location": "San Francisco, CA",
      "category": "Engineering",
      "salaryMin": 120000,
      "salaryMax": 180000,
      "salaryCurrency": "USD",
      "description": "We are seeking an experienced software engineer...",
      "companyWebsite": "https://recruitify.com",
      "companyDescription": "Recruitify is a leading job platform...",
      "createdAt": "2025-01-15T10:00:00Z"
    }
    ```
    [Source: architecture/5-api-specification.md patterns and AC 2, 3]

**Routing Architecture**:

*   **Dynamic Route**: `/jobs/[jobId].tsx` uses Next.js dynamic routing pattern
*   **URL Format**: `/jobs/123e4567-e89b-12d3-a456-426614174000`
*   **Route Parameters**: Access `jobId` using Next.js `useRouter()` hook: `const router = useRouter(); const { jobId } = router.query;`
*   **Navigation**: Use Next.js `Link` component for client-side navigation (no full page reload)

[Source: architecture/10-frontend-architecture.md#routing-architecture]

**Component Architecture**:

Page component structure for job detail page:

```
pages/jobs/[jobId].tsx                 # Main page component (handles routing, data fetching)
  ├── JobDetailHeader.tsx              # Displays title, company, location
  ├── JobDetailContent.tsx             # Displays full job description
  └── JobDetailSidebar.tsx             # Displays additional info (salary, category, date)
```

*   **JobDetailHeader**: Use Ant Design `Typography.Title` for job title, `Typography.Text` for company/location. [Source: architecture/3-tech-stack.md]
*   **JobDetailContent**: Use Ant Design `Typography.Paragraph` with `style={{ whiteSpace: 'pre-wrap' }}` to preserve line breaks in description. [Source: architecture/3-tech-stack.md]
*   **JobDetailSidebar**: Use Ant Design `Descriptions` component to display key-value pairs (Salary Range, Category, Posted Date). [Source: architecture/3-tech-stack.md]

[Source: architecture/10-frontend-architecture.md#component-organization]

**State Management**:

Create a dedicated store for job detail page to avoid polluting the jobs list store:

```typescript
// In apps/web/src/stores/useJobDetailStore.ts
interface JobDetailStore {
  currentJob: JobDetail | null;
  isLoading: boolean;
  error: string | null;
  fetchJobDetail: (jobId: string) => Promise<void>;
  clearJobDetail: () => void;
}
```

Why separate store?
- Jobs list store manages paginated list state (multiple jobs)
- Job detail store manages single job state
- Avoids state conflicts and keeps concerns separated
- Easier to test and maintain

[Source: architecture/10-frontend-architecture.md#state-structure]

**File Locations**:

*   **Backend**:
    *   Repository: `apps/api/src/main/java/com/recruitify/repository/JobPostingRepository.java` (add method)
    *   Service: `apps/api/src/main/java/com/recruitify/service/JobService.java` (add method)
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/JobController.java` (add endpoint)
    *   DTO: `apps/api/src/main/java/com/recruitify/dto/JobDetailDto.java` (new)
    *   Tests: `apps/api/src/test/java/com/recruitify/service/JobServiceTest.java`, `apps/api/src/test/java/com/recruitify/controller/JobControllerIntegrationTest.java` (extend existing)

*   **Frontend**:
    *   Shared Types: `packages/shared-types/job.ts` (add interface)
    *   Service: `apps/web/src/services/jobService.ts` (add method)
    *   Store: `apps/web/src/stores/useJobDetailStore.ts` (new)
    *   Page: `apps/web/src/pages/jobs/[jobId].tsx` (new)
    *   Components:
        *   `apps/web/src/features/jobs/JobDetailHeader.tsx` (new)
        *   `apps/web/src/features/jobs/JobDetailContent.tsx` (new)
        *   `apps/web/src/features/jobs/JobDetailSidebar.tsx` (new)
        *   `apps/web/src/features/jobs/JobListingCard.tsx` (modify to add link)
    *   Tests: Co-located with components

*   **E2E**: `e2e/job-details.spec.ts` (new)

[Source: architecture/12-unified-project-structure.md#project-directory-structure]

**Security Considerations**:

*   **Public Endpoint**: Job detail endpoint is public (no authentication) to allow anyone to view job postings. [Source: AC 3]
*   **Sensitive Data Exclusion**: `JobDetailDto` should exclude `recruiterId` from API response (internal field only). Backend should NOT expose recruiter contact info on public job details. [Source: Security best practice]
*   **Status Filtering**: Only jobs with `status = 'ACTIVE'` should be returned. Inactive or closed jobs should return 404. [Source: Security best practice]
*   **Input Validation**: Validate `jobId` parameter is valid UUID format before querying database. [Source: architecture/18-error-handling-strategy.md]

**SEO and Performance Considerations**:

*   **Dynamic Page Titles**: Set unique page title for each job using Next.js `Head` component: `<title>{jobTitle} at {companyName} | Recruitify</title>`. [Source: SEO best practice]
*   **Meta Tags**: Add Open Graph tags for social media sharing (og:title, og:description, og:url). [Source: SEO best practice]
*   **Server-Side Rendering (Future)**: Consider implementing `getServerSideProps()` in future iterations for better SEO and initial load performance. For MVP, client-side fetching is acceptable. [Source: Next.js best practice]
*   **Caching**: Consider implementing client-side caching of job details to avoid re-fetching when navigating back from detail page. Can use Zustand persist middleware. [Source: Performance best practice]

**Error Handling**:

*   **404 Not Found**: When job doesn't exist or is inactive, display friendly error message: "This job posting is no longer available" with button to return to job listings. [Source: UX best practice]
*   **Loading State**: Display skeleton loader while fetching job details to improve perceived performance. [Source: UX best practice]
*   **Network Errors**: Display error message with retry button if API call fails. [Source: architecture/18-error-handling-strategy.md]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `JobDetailHeader.tsx`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   React hooks: `useCamelCase` (e.g., `useJobDetailStore.ts`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   Java classes: `PascalCase` (e.g., `JobDetailDto.java`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   API endpoints: `kebab-case` with RESTful resource naming (e.g., `/api/v1/jobs/{jobId}`) [Source: architecture/17-coding-standards.md#naming-conventions]
*   Dynamic route files: `[paramName].tsx` (e.g., `[jobId].tsx`) [Source: Next.js convention]

**Testing**

**Unit Tests:**
*   **Backend**: Use JUnit 5 & Mockito. Test `JobService.getJobById()` with various scenarios (found, not found, inactive). [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
*   **Frontend**: Use Jest & React Testing Library. Test components render correctly with mock data. Test loading and error states. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]

**Integration Tests:**
*   Backend controller-service-repository tests to verify full API request/response cycle for `GET /api/v1/jobs/{jobId}`. Test 200 OK and 404 Not Found scenarios. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]

**E2E Tests:**
*   Use Playwright to test complete user journey: Navigate to jobs page → Click job card → View job details → Return to job list. Test deep linking (direct URL access). Test 404 handling. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]

**Test Coverage Requirements:**
*   Test successful job detail retrieval (200 OK)
*   Test job not found scenario (404 Not Found)
*   Test inactive job returns 404
*   Test navigation from job list to detail page
*   Test "Back to Jobs" navigation
*   Test loading and error states in UI
*   Test deep linking to job detail URL
*   Tests should be placed according to the testing strategy: backend tests in `src/test/java`, frontend tests co-located, E2E tests in `e2e/` directory. [Source: architecture/16-testing-strategy.md#test-organization]

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 1, Story 1.5 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
