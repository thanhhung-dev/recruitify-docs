# Story 3.2: Job Seeker "Saved Jobs" Page

**Status**: Draft

**Story**

As a logged-in job seeker,
I want a dedicated page where I can view all the jobs I have saved,
so that I can easily review them and decide whether to apply.

**Acceptance Criteria**

1. A logged-in job seeker can navigate to a "Saved Jobs" page.
2. The page displays a list of all jobs the user has previously saved.
3. The user can click on any job in the list to navigate to its full detail page.
4. The user can remove a job from their saved list directly from this page.

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend API to Fetch User's Saved Jobs (AC: 2)**
  - [ ] Subtask 1.1: Update `SavedJobService` with `getMySavedJobs(userId)` method using `SavedJobRepository.findByUserId()`. [Source: Story 1.6 foundation]
  - [ ] Subtask 1.2: Join with JobPosting and Company entities to get full job details. [Source: Story 3.1 patterns]
  - [ ] Subtask 1.3: Sort saved jobs by `savedAt DESC` (newest first). [Source: UX best practice]
  - [ ] Subtask 1.4: Map to `SavedJobWithDetailsDto` that includes all job information needed for display. [Source: AC 2, 3]

- [ ] **Task 2: Create SavedJobWithDetailsDto (AC: 2, 3)**
  - [ ] Subtask 2.1: Create `SavedJobWithDetailsDto` with fields: `savedJobId`, `jobId`, `jobTitle`, `companyName`, `location`, `employmentType`, `savedAt`, `jobStatus`. [Source: AC 2, 3]
  - [ ] Subtask 2.2: Include job details for display without additional API calls. [Source: Performance]
  - [ ] Subtask 2.3: Include `savedAt` timestamp for sorting and display purposes. [Source: AC 2]

- [ ] **Task 3: Create Saved Jobs List Endpoint (AC: 1, 2)**
  - [ ] Subtask 3.1: Update `SavedJobController` with `GET /api/v1/saved-jobs/my-saved-jobs` endpoint. [Source: architecture/11-backend-architecture.md]
  - [ ] Subtask 3.2: Endpoint requires authentication and JOB_SEEKER role. [Source: Story 1.6 security patterns]
  - [ ] Subtask 3.3: Extract user ID from JWT token for security. [Source: Story 1.6 security]
  - [ ] Subtask 3.4: Return `List<SavedJobWithDetailsDto>` sorted by savedAt DESC. [Source: AC 2]
  - [ ] Subtask 3.5: Return empty array `[]` when user has no saved jobs. [Source: REST best practices]
  - [ ] Subtask 3.6: Return 401 Unauthorized if not authenticated. [Source: Security]

- [ ] **Task 4: Update Shared TypeScript Types for Saved Jobs Page (AC: 2, 3)**
  - [ ] Subtask 4.1: Add `SavedJobWithDetails` interface to `packages/shared-types/savedJob.ts`. [Source: architecture/17-coding-standards.md]
  - [ ] Subtask 4.2: Define interface matching backend DTO with all required display fields. [Source: AC 2, 3]
  - [ ] Subtask 4.3: Include job details and saved timestamp. [Source: AC 2, 3]

- [ ] **Task 5: Create Frontend Saved Jobs Service (AC: 2)**
  - [ ] Subtask 5.1: Update `apps/web/src/services/savedJobService.ts` with `getMySavedJobs()` function. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 5.2: Function calls `GET /api/v1/saved-jobs/my-saved-jobs` with authentication. [Source: AC 2]
  - [ ] Subtask 5.3: Return type `Promise<SavedJobWithDetails[]>`. [Source: TypeScript types]

- [ ] **Task 6: Update Saved Jobs Store for Page Management (AC: 2, 4)**
  - [ ] Subtask 6.1: Update `apps/web/src/stores/useSavedJobsStore.ts` with saved jobs list state. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 6.2: Add state: `savedJobsList` array, `isLoadingList`, `listError`. [Source: State management]
  - [ ] Subtask 6.3: Create action `fetchMySavedJobs()` that calls savedJobService.getMySavedJobs(). [Source: AC 2]
  - [ ] Subtask 6.4: Create action `removeFromSavedJobs(jobId)` that calls unsave and updates both list and savedJobIds set. [Source: AC 4]
  - [ ] Subtask 6.5: Ensure actions sync between saved jobs page and individual job save buttons. [Source: State consistency]

- [ ] **Task 7: Create Saved Job Card Component (AC: 2, 3, 4)**
  - [ ] Subtask 7.1: Create `apps/web/src/features/savedJobs/SavedJobCard.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 7.2: Card displays: Job Title (clickable link), Company Name, Location, Employment Type, Saved Date. [Source: AC 2, 3]
  - [ ] Subtask 7.3: Use Ant Design `Card` component with hover effects. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 7.4: Include "View Job" button that navigates to job detail page. [Source: AC 3]
  - [ ] Subtask 7.5: Include "Remove" button that removes job from saved list. [Source: AC 4]
  - [ ] Subtask 7.6: Show relative time format for saved date (e.g., "Saved 3 days ago"). [Source: UX best practice]
  - [ ] Subtask 7.7: Add confirmation modal for remove action to prevent accidental deletions. [Source: UX best practice]

- [ ] **Task 8: Create Saved Jobs List Component (AC: 2)**
  - [ ] Subtask 8.1: Create `apps/web/src/features/savedJobs/SavedJobsList.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 8.2: Display grid/list of `SavedJobCard` components. [Source: AC 2]
  - [ ] Subtask 8.3: Use Ant Design `List` component with responsive grid layout. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 8.4: Add loading state using `Skeleton` components while fetching data. [Source: UX best practice]
  - [ ] Subtask 8.5: Add empty state: "You haven't saved any jobs yet. Start exploring opportunities!" with link to jobs page. [Source: UX best practice]
  - [ ] Subtask 8.6: Add search/filter functionality to search saved jobs by title or company. [Source: Usability]

- [ ] **Task 9: Create "Saved Jobs" Page (AC: 1, 2)**
  - [ ] Subtask 9.1: Create `apps/web/src/pages/saved-jobs.tsx` route for `/saved-jobs`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 9.2: Add route guard to ensure only authenticated JOB_SEEKER users can access. [Source: Story 1.6 auth patterns]
  - [ ] Subtask 9.3: Page header with "Saved Jobs" title and count of saved jobs. [Source: Page UX]
  - [ ] Subtask 9.4: Fetch saved jobs on page load using `useSavedJobsStore.fetchMySavedJobs()`. [Source: AC 2]
  - [ ] Subtask 9.5: Display `SavedJobsList` component with fetched data. [Source: AC 2]
  - [ ] Subtask 9.6: Handle error states gracefully with retry button. [Source: Error handling]

- [ ] **Task 10: Add Navigation Link to "Saved Jobs" (AC: 1)**
  - [ ] Subtask 10.1: Update main navigation component to include "Saved Jobs" link for JOB_SEEKER users. [Source: AC 1]
  - [ ] Subtask 10.2: Add "Saved Jobs" link to user profile dropdown menu. [Source: AC 1]
  - [ ] Subtask 10.3: Link navigates to `/saved-jobs` route. [Source: AC 1]
  - [ ] Subtask 10.4: Show count badge with number of saved jobs (optional enhancement). [Source: UX feedback]
  - [ ] Subtask 10.5: Ensure link is only visible to authenticated JOB_SEEKER users. [Source: RBAC]

- [ ] **Task 11: Create Saved Jobs Summary Component (AC: 2)**
  - [ ] Subtask 11.1: Create `apps/web/src/features/savedJobs/SavedJobsHeader.tsx` component. [Source: Page structure]
  - [ ] Subtask 11.2: Display total count of saved jobs and recent activity. [Source: Dashboard UX]
  - [ ] Subtask 11.3: Include quick actions: "Browse More Jobs" button. [Source: User engagement]
  - [ ] Subtask 11.4: Use Ant Design `Statistic` and `Row`/`Col` components. [Source: architecture/3-tech-stack.md]

- [ ] **Task 12: Integrate with Job Detail Page Save Button (AC: 4)**
  - [ ] Subtask 12.1: Update save/unsave actions in `SaveJobButton` to refresh saved jobs list. [Source: State sync]
  - [ ] Subtask 12.2: Use global state to ensure changes reflect in saved jobs page immediately. [Source: State management]
  - [ ] Subtask 12.3: Add navigation hint: "View in Saved Jobs" link after saving. [Source: UX continuity]

- [ ] **Task 13: Implement Backend Unit Tests (AC: 2)**
  - [ ] Subtask 13.1: Write unit test for `SavedJobService.getMySavedJobs()` to verify fetching user's saved jobs. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 13.2: Write unit test to verify saved jobs are sorted by savedAt date (newest first). [Source: AC 2]
  - [ ] Subtask 13.3: Write unit test to verify job details are included in response. [Source: AC 2, 3]
  - [ ] Subtask 13.4: Write unit test to verify empty array returned when user has no saved jobs. [Source: Edge case]
  - [ ] Subtask 13.5: Place tests in `apps/api/src/test/java/com/recruitify/service/SavedJobServiceTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 14: Implement Backend Integration Tests (AC: 1, 2)**
  - [ ] Subtask 14.1: Write integration test for `GET /api/v1/saved-jobs/my-saved-jobs` endpoint. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 14.2: Verify 200 OK response with correct saved jobs data. [Source: AC 2]
  - [ ] Subtask 14.3: Verify authenticated user only sees their own saved jobs. [Source: Security]
  - [ ] Subtask 14.4: Verify 401 Unauthorized when not authenticated. [Source: Security]
  - [ ] Subtask 14.5: Verify 403 Forbidden when RECRUITER tries to access endpoint. [Source: RBAC]
  - [ ] Subtask 14.6: Verify empty array returned when user has no saved jobs. [Source: Edge case]
  - [ ] Subtask 14.7: Place tests in `apps/api/src/test/java/com/recruitify/controller/SavedJobControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 15: Implement Frontend Component Tests (AC: 2, 3, 4)**
  - [ ] Subtask 15.1: Write unit test for `SavedJobCard` to verify it displays all required job info. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 15.2: Write unit test for `SavedJobsList` to verify it renders multiple cards. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 15.3: Write unit test for empty state when no saved jobs. [Source: UX coverage]
  - [ ] Subtask 15.4: Write unit test for remove button functionality with confirmation modal. [Source: AC 4]
  - [ ] Subtask 15.5: Place tests co-located: `SavedJobCard.test.tsx`, `SavedJobsList.test.tsx`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 16: Implement E2E Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 16.1: Create Playwright E2E test for job seeker viewing their saved jobs page. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.2: Test navigating to "Saved Jobs" page from main navigation. [Source: AC 1]
  - [ ] Subtask 16.3: Test page displays all saved jobs user has previously saved. [Source: AC 2]
  - [ ] Subtask 16.4: Test clicking job title navigates to job details page. [Source: AC 3]
  - [ ] Subtask 16.5: Test removing job from saved list updates the page immediately. [Source: AC 4]
  - [ ] Subtask 16.6: Test empty state when user has no saved jobs. [Source: Edge case]
  - [ ] Subtask 16.7: Test RECRUITER cannot access "Saved Jobs" page. [Source: RBAC]
  - [ ] Subtask 16.8: Test unauthenticated user is redirected to login. [Source: Security]
  - [ ] Subtask 16.9: Place tests in `e2e/job-seeker-saved-jobs.spec.ts`. [Source: architecture/16-testing-strategy.md]

**Dev Notes**

**Previous Story Dependencies**: This story depends on:
- **Story 1.6** (Save a Job): The complete saved jobs infrastructure including `SavedJob` entity, `SavedJobRepository`, `SavedJobService`, and `SavedJobController` with save/unsave/check endpoints. This story extends that foundation to display the list view.
- **Story 1.2** (Registration & Login): Authentication system for JOB_SEEKER users.
- **Story 1.3-1.5** (Job Browsing): Job entity and detail page structure for navigation back to jobs.

This story completes the saved jobs feature by providing a dedicated management interface for job seekers to review and organize their saved opportunities.

**Data Security**: This story follows the same security principles as Story 3.1. Job seekers can ONLY see their own saved jobs, never other users' saved jobs. The user ID is extracted from the JWT, not from request parameters, to prevent unauthorized access.

**Data Models**:

*   **SavedJobWithDetails (New DTO for List View)**:
    *   `savedJobId`: `string` (composite key representation)
    *   `jobId`: `string` (UUID)
    *   `jobTitle`: `string`
    *   `companyName`: `string`
    *   `location`: `string`
    *   `employmentType`: `EmploymentType`
    *   `jobStatus`: `JobStatus` (ACTIVE, INACTIVE, etc.)
    *   `savedAt`: `Date`
    *   [Source: AC 2, 3]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/savedJob.ts (extending existing)
export interface SavedJobWithDetails {
  savedJobId: string;
  jobId: string;
  jobTitle: string;
  companyName: string;
  location: string;
  employmentType: EmploymentType;
  jobStatus: JobStatus;
  savedAt: Date;
}

export interface SavedJobsStats {
  total: number;
  recent: number; // Saved in last 7 days
}
```

**API Specifications**:

*   **GET /api/v1/saved-jobs/my-saved-jobs**:
    *   Fetches all saved jobs for authenticated job seeker with job details
    *   Requires authentication + JOB_SEEKER role
    *   Extracts user ID from JWT (not from request params) for security
    *   Returns 200 OK with `List<SavedJobWithDetailsDto>`
    *   Returns empty array `[]` if user has no saved jobs
    *   Returns 401 Unauthorized if not authenticated
    *   Returns 403 Forbidden if not JOB_SEEKER role
    *   Saved jobs sorted by `savedAt DESC` (newest first)
    *   [Source: AC 1, 2]

**Database Query Example**:

```java
// In SavedJobService.java
public List<SavedJobWithDetailsDto> getMySavedJobs(UUID userId) {
    List<SavedJob> savedJobs = savedJobRepository.findByUserIdWithJobDetails(userId);
    
    return savedJobs.stream()
        .map(savedJob -> {
            JobPosting job = savedJob.getJobPosting();
            Company company = job.getCompany();
            
            return SavedJobWithDetailsDto.builder()
                .savedJobId(savedJob.getUserId() + ":" + savedJob.getJobPostingId())
                .jobId(job.getId())
                .jobTitle(job.getTitle())
                .companyName(company.getName())
                .location(job.getLocation())
                .employmentType(job.getEmploymentType())
                .jobStatus(job.getStatus())
                .savedAt(savedJob.getSavedAt())
                .build();
        })
        .sorted(Comparator.comparing(SavedJobWithDetailsDto::getSavedAt).reversed())
        .collect(Collectors.toList());
}
```
[Source: AC 2 and Story 1.6 patterns]

**Component Specifications**:

*   **SavedJobCard**: Individual saved job card component. Shows job info with prominent "View Job" and "Remove" buttons. Uses Ant Design `Card` with action buttons. Includes relative time for saved date. [Source: architecture/10-frontend-architecture.md and AC 2, 3, 4]

*   **SavedJobsList**: Container component that displays grid of saved job cards. Uses Ant Design `List` with `grid` prop for responsive layout. Includes search functionality. Shows empty state with CTA to browse jobs. [Source: architecture/10-frontend-architecture.md and AC 2]

*   **SavedJobsHeader**: Page header component with title, count, and quick actions. Shows summary statistics and navigation to jobs page. [Source: Dashboard UX pattern]

**File Locations**:

*   **Backend**:
    *   Service: `apps/api/src/main/java/com/recruitify/service/SavedJobService.java` (update existing)
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/SavedJobController.java` (update existing)  
    *   DTOs: `apps/api/src/main/java/com/recruitify/dto/SavedJobWithDetailsDto.java` (new)
    *   Repository: `apps/api/src/main/java/com/recruitify/repository/SavedJobRepository.java` (update with new query method)

*   **Frontend**:
    *   Pages: `apps/web/src/pages/saved-jobs.tsx` (new)
    *   Components: `apps/web/src/features/savedJobs/SavedJobCard.tsx`, `SavedJobsList.tsx`, `SavedJobsHeader.tsx` (new)
    *   Services: `apps/web/src/services/savedJobService.ts` (update existing)
    *   Stores: `apps/web/src/stores/useSavedJobsStore.ts` (update existing)

*   **Shared Types**: `packages/shared-types/savedJob.ts` (update existing)

**Testing Requirements**:

*   **Unit Tests:**
    *   Backend: Test `SavedJobService.getMySavedJobs()`, verify sorting, verify only user's saved jobs returned with full details
    *   Frontend: Test saved job card and list components, test empty state, test remove functionality
    *   [Source: architecture/16-testing-strategy.md]

*   **Integration Tests:**
    *   Backend: Test endpoint with various scenarios (has saved jobs, no saved jobs, wrong role, not authenticated)
    *   Critical: Verify user A cannot see user B's saved jobs
    *   [Source: architecture/16-testing-strategy.md]

*   **E2E Tests:**
    *   Complete flow: Login as job seeker → Navigate to Saved Jobs → View list → Click job → Navigate to job details → Remove from list
    *   Test empty state, test with multiple saved jobs
    *   [Source: architecture/16-testing-strategy.md]

**Technical Constraints**:

*   **User ID from JWT**: CRITICAL - User ID MUST be extracted from JWT token, never from request parameters. This prevents unauthorized access to other users' data. [Source: Security best practice and Story 1.6 patterns]
*   **Role Enforcement**: Only JOB_SEEKER role can access this endpoint. RECRUITER users should not see this page. [Source: Story 1.6 RBAC]
*   **Performance**: Use efficient JOIN queries to fetch job and company details with saved jobs in single query. Avoid N+1 query problem. [Source: architecture/15-security-and-performance.md and Story 1.6 patterns]
*   **State Synchronization**: Changes in saved jobs page must sync with individual job save buttons throughout the app. [Source: State consistency]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `SavedJobCard.tsx`)
*   React hooks: `useCamelCase` (e.g., `useSavedJobsStore.ts`)
*   Java classes: `PascalCase` (e.g., `SavedJobWithDetailsDto.java`)
*   API endpoints: `kebab-case` (e.g., `/api/v1/saved-jobs/my-saved-jobs`)
*   [Source: architecture/17-coding-standards.md]

**Security Considerations**:

*   **Authorization**: User can ONLY see their own saved jobs. User ID extracted from JWT ensures this. [Source: AC 2 and security patterns]
*   **SQL Injection**: Use JPA parameterized queries (automatic protection). [Source: architecture/15-security-and-performance.md]
*   **Cross-User Access**: Integration tests must verify user A cannot access user B's saved jobs by any means. [Source: Security testing]
*   **Job Status Filtering**: Only return saved jobs where the job posting is still accessible (consider job status). [Source: Business logic]

**UX Considerations**:

*   **Empty State**: First-time users see friendly empty state: "You haven't saved any jobs yet! Start exploring opportunities." with prominent "Browse Jobs" button. [Source: Onboarding UX]
*   **Date Format**: Show relative time ("Saved 3 days ago") with full date on hover for precision. [Source: Readability]
*   **Visual Hierarchy**: Use card-based layout for easy scanning. Each card is clickable and includes prominent action buttons. [Source: Information architecture]
*   **Quick Navigation**: Each saved job card links to the full job details page. Include breadcrumb navigation. [Source: Task completion]
*   **Remove Confirmation**: Show confirmation modal before removing to prevent accidental deletions. [Source: Error prevention]
*   **Search/Filter**: Allow searching saved jobs by title or company for easier management as list grows. [Source: Usability]

**Performance Considerations**:

*   **Database Query**: Use JOIN FETCH to eagerly load JobPosting and Company in single query. Avoid N+1 problem. [Source: architecture/15-security-and-performance.md and Story 1.6 patterns]
    ```java
    @Query("SELECT sj FROM SavedJob sj " +
           "JOIN FETCH sj.jobPosting jp " +  
           "JOIN FETCH jp.company " +
           "WHERE sj.userId = :userId " +
           "ORDER BY sj.savedAt DESC")
    List<SavedJob> findByUserIdWithJobDetails(@Param("userId") UUID userId);
    ```
*   **Pagination**: For MVP, load all saved jobs. For production, implement pagination if user has >50 saved jobs. [Source: Performance]
*   **Caching**: Consider caching saved jobs list on frontend for 5 minutes to reduce API calls when navigating between tabs. [Source: Performance]

**Accessibility Considerations**:

*   **WCAG AA Compliance**: Ensure sufficient color contrast for all interactive elements. [Source: PRD accessibility requirement]
*   **Screen Readers**: Use proper semantic HTML and ARIA labels for action buttons. [Source: Accessibility]
*   **Keyboard Navigation**: Ensure all cards and buttons are keyboard accessible with clear focus indicators. [Source: WCAG AA]

**Integration with Other Stories**:
- **Story 1.6**: Uses the saved jobs infrastructure and extends it with list view
- **Story 3.1**: Similar patterns for user-specific data access and display
- **Future Enhancement**: Could integrate with application tracking to show "Applied" badges on saved jobs

**Future Enhancements** (Not in MVP):
*   Export saved jobs list to PDF/CSV
*   Advanced filtering (by date saved, location, company, employment type)
*   Bulk actions (remove multiple, apply to multiple)
*   Job recommendation based on saved jobs pattern
*   Email digest of new similar jobs based on saved jobs
*   Tags/categories for organizing saved jobs
*   Notes feature for each saved job

**Testing**

**Unit Tests:**
*   **Backend**: Use JUnit 5 & Mockito. Test service methods for fetching saved jobs with details, verify sorting, verify only user's jobs returned. [Source: architecture/16-testing-strategy.md]
*   **Frontend**: Use Jest & React Testing Library. Test saved job card and list components, test empty state, test remove functionality. [Source: architecture/16-testing-strategy.md]

**Integration Tests:**
*   Backend controller-service-repository tests to verify full API request/response cycle with JWT authentication. Test various user scenarios and security boundaries. [Source: architecture/16-testing-strategy.md]

**E2E Tests:**
*   Use Playwright to test complete user journey: Login → Navigate to Saved Jobs → View list → Remove job → Click job → Navigate to job details. Test empty state and multiple saved jobs scenarios. [Source: architecture/16-testing-strategy.md]

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 3, Story 3.2 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
