# Story 1.2: Basic Job Seeker Registration & Login

**Status**: Approved

**Story**
As a first-time visitor,
I want to register for an account and log in,
so that I can access personalized features of the platform.

**Acceptance Criteria**
1.  A user can navigate to a registration page with fields for email and password.
2.  Upon submitting the registration form, a new user record is created in the database.
3.  A user can navigate to a login page.
4.  Upon successful login with correct credentials, the user is authenticated and redirected to the homepage.
5.  Appropriate error messages are shown for invalid registration or login attempts (e.g., "User already exists," "Invalid credentials").

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend User Entity and Repository (AC: 2)**
  - [ ] Subtask 1.1: Create `User` entity class in `recruitify-server/src/main/java/com/recruitify/entities/User.java` with fields: `id` (UUID), `email`, `passwordHash`, `role`, `createdAt`, `updatedAt`. [Source: architecture/4-data-models.md#model-user]
  - [ ] Subtask 1.2: Add validation annotations to entity fields (e.g., `@NotNull`, `@Email`).
  - [ ] Subtask 1.3: Create `UserRepository` interface in `recruitify-server/src/main/java/com/recruitify/repository/UserRepository.java` extending `JpaRepository<User, UUID>`. [Source: architecture/11-backend-architecture.md#data-access-layer-dal]
  - [ ] Subtask 1.4: Add method `Optional<User> findByEmail(String email)` to UserRepository. [Source: architecture/11-backend-architecture.md#repository-example]

- [ ] **Task 2: Implement Password Hashing Service (AC: 2, 4)**
  - [ ] Subtask 2.1: Configure Spring Security's `BCryptPasswordEncoder` bean for password hashing. [Source: architecture/11-backend-architecture.md#authentication-and-authorization]
  - [ ] Subtask 2.2: Create password encoding utility methods for registration and validation.

- [ ] **Task 3: Implement JWT Token Service (AC: 4)**
  - [ ] Subtask 3.1: Create `JwtService` class in `recruitify-server/src/main/java/com/recruitify/service/JwtService.java` to generate JWT tokens containing user ID and role. [Source: architecture/11-backend-architecture.md#authentication-flow-login]
  - [ ] Subtask 3.2: Implement token validation method.
  - [ ] Subtask 3.3: Configure JWT secret and expiration in `application.yml`.

- [ ] **Task 4: Create Registration Endpoint (AC: 1, 2, 5)**
  - [ ] Subtask 4.1: Create `AuthController` in `recruitify-server/src/main/java/com/recruitify/controller/AuthController.java`. [Source: architecture/11-backend-architecture.md#controllerroute-organization]
  - [ ] Subtask 4.2: Create `RegisterUserDto` class with email and password fields.
  - [ ] Subtask 4.3: Implement `POST /api/v1/auth/register` endpoint that accepts RegisterUserDto.
  - [ ] Subtask 4.4: Create `AuthService` to handle business logic for registration. [Source: architecture/8-core-workflows.md#workflow-new-user-registration]
  - [ ] Subtask 4.5: In AuthService, check if user with email already exists, if yes return error "User already exists". (AC: 5)
  - [ ] Subtask 4.6: Hash password using BCryptPasswordEncoder before saving. [Source: architecture/8-core-workflows.md#workflow-new-user-registration]
  - [ ] Subtask 4.7: Set default role as `JOB_SEEKER` for registration. [Source: architecture/4-data-models.md#model-user]
  - [ ] Subtask 4.8: Save user to database and return 201 Created with JWT token.

- [ ] **Task 5: Create Login Endpoint (AC: 3, 4, 5)**
  - [ ] Subtask 5.1: Create `LoginUserDto` class with email and password fields.
  - [ ] Subtask 5.2: Implement `POST /api/v1/auth/login` endpoint in AuthController. [Source: architecture/11-backend-architecture.md#controllerroute-organization]
  - [ ] Subtask 5.3: In AuthService, find user by email from database. [Source: architecture/11-backend-architecture.md#authentication-flow-login]
  - [ ] Subtask 5.4: Verify submitted password against stored hash using BCryptPasswordEncoder.
  - [ ] Subtask 5.5: If passwords match, generate JWT token containing user ID and role. [Source: architecture/11-backend-architecture.md#authentication-flow-login]
  - [ ] Subtask 5.6: Return 200 OK with JWT token in response body.
  - [ ] Subtask 5.7: If passwords don't match or user not found, return 401 Unauthorized with error "Invalid credentials". (AC: 5)

- [ ] **Task 6: Implement JWT Authorization Filter (AC: 4)**
  - [ ] Subtask 6.1: Create `JwtAuthorizationFilter` class extending Spring Security's filter. [Source: architecture/11-backend-architecture.md#authorization-filter-middleware]
  - [ ] Subtask 6.2: Extract and validate JWT from Authorization header (Bearer token).
  - [ ] Subtask 6.3: Set Spring Security context with user identity if token is valid.
  - [ ] Subtask 6.4: Configure Spring Security to use this filter in the security filter chain.

- [ ] **Task 7: Create Shared TypeScript Types (AC: 1, 3)**
  - [ ] Subtask 7.1: Create `packages/shared-types/auth.ts` with `User`, `RegisterRequest`, `LoginRequest`, and `AuthResponse` interfaces. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
  - [ ] Subtask 7.2: Ensure User interface matches backend model (id, email, role, createdAt, updatedAt).

- [ ] **Task 8: Create Frontend Auth Service Layer (AC: 1, 3, 4)**
  - [ ] Subtask 8.1: Set up axios client in `recruitify-client/src/services/apiClient.ts` with base URL `/api/v1` and request interceptor for attaching JWT token. [Source: architecture/10-frontend-architecture.md#api-client-setup]
  - [ ] Subtask 8.2: Create `recruitify-client/src/services/authService.ts` with `register()` and `login()` functions. [Source: architecture/10-frontend-architecture.md#service-example]
  - [ ] Subtask 8.3: Implement `register(email, password)` calling `POST /api/v1/auth/register`.
  - [ ] Subtask 8.4: Implement `login(email, password)` calling `POST /api/v1/auth/login`.

- [ ] **Task 9: Create User Store with Zustand (AC: 4)**
  - [ ] Subtask 9.1: Create `recruitify-client/src/stores/useUserStore.ts`. [Source: architecture/10-frontend-architecture.md#state-structure]
  - [ ] Subtask 9.2: Define state shape with `user`, `token`, and `isAuthenticated` fields.
  - [ ] Subtask 9.3: Create actions: `setUser(user, token)`, `logout()`.
  - [ ] Subtask 9.4: Use Zustand's `persist` middleware to save token to localStorage. [Source: architecture/10-frontend-architecture.md#state-management-patterns]
  - [ ] Subtask 9.5: Ensure immutable state updates using `set` function. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]

- [ ] **Task 10: Create Registration Page UI (AC: 1, 2, 5)**
  - [ ] Subtask 10.1: Create page at `recruitify-client/src/pages/register.tsx`. [Source: architecture/10-frontend-architecture.md#route-organization]
  - [ ] Subtask 10.2: Create `recruitify-client/src/features/auth/RegisterForm.tsx` component using Ant Design Form component. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 10.3: Add email input field with validation (required, valid email format).
  - [ ] Subtask 10.4: Add password input field with validation (required, minimum length).
  - [ ] Subtask 10.5: Add submit button.
  - [ ] Subtask 10.6: On form submit, call `authService.register()` using async action pattern.
  - [ ] Subtask 10.7: On success, store token in `useUserStore` and redirect to homepage. (AC: 4)
  - [ ] Subtask 10.8: Display error messages from API response (e.g., "User already exists"). (AC: 5)

- [ ] **Task 11: Create Login Page UI (AC: 3, 4, 5)**
  - [ ] Subtask 11.1: Create page at `recruitify-client/src/pages/login.tsx`. [Source: architecture/10-frontend-architecture.md#route-organization]
  - [ ] Subtask 11.2: Create `recruitify-client/src/features/auth/LoginForm.tsx` component using Ant Design Form component. [Source: architecture/10-frontend-architecture.md#component-organization]
  - [ ] Subtask 11.3: Add email and password input fields with validation.
  - [ ] Subtask 11.4: Add submit button.
  - [ ] Subtask 11.5: On form submit, call `authService.login()`.
  - [ ] Subtask 11.6: On successful login, store JWT token and user data in `useUserStore`. (AC: 4)
  - [ ] Subtask 11.7: Redirect authenticated user to homepage. (AC: 4)
  - [ ] Subtask 11.8: Display error message for invalid credentials (401 response). (AC: 5)

- [ ] **Task 12: Add Navigation Links (AC: 1, 3)**
  - [ ] Subtask 12.1: Update app navigation/header component to include links to `/register` and `/login` pages.
  - [ ] Subtask 12.2: Hide login/register links for authenticated users, show logout option instead.

- [ ] **Task 13: Implement Backend Unit Tests**
  - [ ] Subtask 13.1: Write unit tests for `AuthService.register()` method using JUnit 5 and Mockito, verifying password hashing and repository calls. [Source: architecture/16-testing-strategy.md#backend-unit-test-example-junit-5-mockito]
  - [ ] Subtask 13.2: Write unit tests for `AuthService.login()` method, testing successful login and invalid credentials scenarios.
  - [ ] Subtask 13.3: Write unit tests for `JwtService` token generation and validation methods.
  - [ ] Subtask 13.4: Test files should be in `recruitify-server/src/test/java/com/recruitify/service/`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 14: Implement Frontend Unit Tests**
  - [ ] Subtask 14.1: Write unit tests for `RegisterForm` component using Jest and React Testing Library. [Source: architecture/16-testing-strategy.md#frontend-component-test-example-jest-rtl]
  - [ ] Subtask 14.2: Test form validation, submit button, and error display.
  - [ ] Subtask 14.3: Write unit tests for `LoginForm` component.
  - [ ] Subtask 14.4: Test files should be co-located: `RegisterForm.test.tsx` and `LoginForm.test.tsx`. [Source: architecture/16-testing-strategy.md#test-organization]

- [ ] **Task 15: Implement Backend Integration Tests**
  - [ ] Subtask 15.1: Write integration test for `POST /api/v1/auth/register` endpoint testing full request/response cycle. [Source: architecture/16-testing-strategy.md#integration-tests-the-middle]
  - [ ] Subtask 15.2: Write integration test for `POST /api/v1/auth/login` endpoint.
  - [ ] Subtask 15.3: Test duplicate email registration error handling.
  - [ ] Subtask 15.4: Test invalid credentials error handling.

- [ ] **Task 16: Implement E2E Tests**
  - [ ] Subtask 16.1: Create Playwright E2E test for complete registration flow in `e2e/auth-registration.spec.ts`. [Source: architecture/16-testing-strategy.md#end-to-end-e2e-tests-the-peak]
  - [ ] Subtask 16.2: Create Playwright E2E test for complete login flow in `e2e/auth-login.spec.ts`.
  - [ ] Subtask 16.3: Test error scenarios (duplicate email, invalid credentials).

**Dev Notes**

**Previous Story Insights**:
Story 1.1 established the project infrastructure including the monorepo structure, database setup, and CI/CD pipeline. This story builds on that foundation by implementing the first user-facing features.

**Data Models**:
*   `User` model: `id` (UUID), `email` (string, unique), `passwordHash` (string, never exposed via API), `role` ('JOB_SEEKER' | 'RECRUITER'), `createdAt` (Date), `updatedAt` (Date). [Source: architecture/4-data-models.md#model-user]
*   For this story, all users will be registered with the `JOB_SEEKER` role by default.
*   Database table `users` already defined in schema with all required fields. [Source: architecture/9-database-schema.md#postgresql-database-schema]

**API Specifications**:
*   Server URL: `/api/v1`. [Source: architecture/5-api-specification.md#rest-api-specification-openapi-30]
*   `POST /api/v1/auth/register` - Request body: `{ email: string, password: string }`. Response: 201 Created with `{ user: User, token: string }`. Error: 400 if user already exists.
*   `POST /api/v1/auth/login` - Request body: `{ email: string, password: string }`. Response: 200 OK with `{ user: User, token: string }`. Error: 401 for invalid credentials. [Source: architecture/11-backend-architecture.md#controllerroute-organization]

**Authentication & Security**:
*   Use Spring Security with JWT for stateless authentication. [Source: architecture/11-backend-architecture.md#authentication-and-authorization]
*   Password hashing: Use BCryptPasswordEncoder before storing passwords. [Source: architecture/8-core-workflows.md#workflow-new-user-registration]
*   JWT token should contain user ID and role claims. [Source: architecture/11-backend-architecture.md#authentication-flow-login]
*   Frontend must send JWT token in `Authorization: Bearer <token>` header for authenticated requests. [Source: architecture/11-backend-architecture.md#authorization-filter-middleware]
*   Token should be stored securely in localStorage via Zustand persist middleware. [Source: architecture/10-frontend-architecture.md#state-management-patterns]

**Component Specifications**:
*   Registration form and login form components should use Ant Design Form components. [Source: architecture/3-tech-stack.md#technology-stack-table]
*   Components should be created in `recruitify-client/src/features/auth/` directory. [Source: architecture/10-frontend-architecture.md#component-organization]
*   Forms should include proper validation and error handling.

**File Locations**:
*   Backend Controllers: `recruitify-server/src/main/java/com/recruitify/controller/AuthController.java`. [Source: architecture/12-unified-project-structure.md#project-directory-structure]
*   Backend Services: `recruitify-server/src/main/java/com/recruitify/service/AuthService.java`, `JwtService.java`.
*   Backend Repositories: `recruitify-server/src/main/java/com/recruitify/repository/UserRepository.java`.
*   Backend Entities: `recruitify-server/src/main/java/com/recruitify/entities/User.java`.
*   Frontend Pages: `recruitify-client/src/pages/register.tsx`, `recruitify-client/src/pages/login.tsx`. [Source: architecture/10-frontend-architecture.md#route-organization]
*   Frontend Components: `recruitify-client/src/features/auth/RegisterForm.tsx`, `LoginForm.tsx`. [Source: architecture/10-frontend-architecture.md#component-organization]
*   Frontend Services: `recruitify-client/src/services/authService.ts`, `apiClient.ts`. [Source: architecture/10-frontend-architecture.md#frontend-services-layer]
*   Frontend Stores: `recruitify-client/src/stores/useUserStore.ts`. [Source: architecture/10-frontend-architecture.md#state-structure]
*   Shared Types: `packages/shared-types/auth.ts`. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]

**Naming Conventions**:
*   React Components: PascalCase (e.g., `RegisterForm.tsx`, `LoginForm.tsx`). [Source: architecture/17-coding-standards.md#naming-conventions]
*   React Hooks: useCamelCase (e.g., `useUserStore.ts`). [Source: architecture/17-coding-standards.md#naming-conventions]
*   Java Classes: PascalCase (e.g., `AuthController.java`, `UserRepository.java`). [Source: architecture/17-coding-standards.md#naming-conventions]
*   API Endpoints: kebab-case (e.g., `/api/v1/auth/register`, `/api/v1/auth/login`). [Source: architecture/17-coding-standards.md#naming-conventions]
*   Database Tables: snake_case (e.g., `users` table). [Source: architecture/17-coding-standards.md#naming-conventions]

**Critical Coding Rules**:
*   ALL shared types between frontend and backend MUST be defined in `packages/shared-types`. No duplicate type definitions. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
*   Frontend components MUST NOT make direct HTTP requests. They MUST call functions from the `services` layer. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
*   DO NOT access `process.env` directly. Use a dedicated configuration module. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]
*   Zustand state MUST NEVER be mutated directly. Always use the `set` function. [Source: architecture/17-coding-standards.md#critical-fullstack-rules]

**External APIs**:
Google Sign-In and LinkedIn Login are planned for future stories but NOT required for this story. This story focuses on email/password authentication only. [Source: architecture/7-external-apis.md]

**Testing**

**Test Organization**:
*   Frontend tests: Co-located with code. `RegisterForm.test.tsx` and `LoginForm.test.tsx` in same directory as components. [Source: architecture/16-testing-strategy.md#test-organization]
*   Backend tests: In `recruitify-server/src/test/java` mirroring package structure of main code. [Source: architecture/16-testing-strategy.md#test-organization]
*   E2E tests: In top-level `e2e/` directory at monorepo root. [Source: architecture/16-testing-strategy.md#test-organization]

**Testing Frameworks**:
*   Frontend: Jest and React Testing Library for unit/component tests. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
*   Backend: JUnit 5 and Mockito for unit and integration tests. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]
*   E2E: Playwright for end-to-end browser testing. [Source: architecture/16-testing-strategy.md#the-testing-pyramid]

**Testing Requirements for This Story**:
*   Unit tests for backend service methods (registration and login business logic) with mocked dependencies. [Source: architecture/16-testing-strategy.md#unit-tests-the-foundation]
*   Unit tests for frontend form components testing rendering, validation, and user interactions.
*   Integration tests for backend API endpoints testing full request/response cycles. [Source: architecture/16-testing-strategy.md#integration-tests-the-middle]
*   E2E tests simulating complete user flows: navigating to registration page, filling form, submitting, and verifying redirect. [Source: architecture/16-testing-strategy.md#end-to-end-e2e-tests-the-peak]

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-05 | 1.0 | Initial draft based on Epic 1, Story 1.2 | Bob (SM) |
| 2025-11-05 | 1.1 | Story approved and ready for development | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
