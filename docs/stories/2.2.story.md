# Story 2.2: Create a Job Posting

**Status**: Draft

**Story**

As a logged-in employer,
I want to fill out a form to create and post a new job listing,
so that I can attract candidates to my open role.

**Acceptance Criteria**

1. A logged-in employer can access a "Post a New Job" page.
2. The page contains a form with all necessary fields for a job listing (e.g., title, location, category, salary, description).
3. Upon successful form submission, a new job record is created in the database, linked to the employer's company.
4. The newly created job becomes publicly visible on the main job listings page.

**Tasks / Subtasks**

- [ ] **Task 1: Create JobPosting Entity (If Not Already Created in Story 1.3) (AC: 3)**
  - [ ] Subtask 1.1: Verify if `JobPosting` entity exists from Story 1.3, otherwise create it in `apps/api/src/main/java/com/recruitify/entities/JobPosting.java`. [Source: Story 1.3 Dev Notes]
  - [ ] Subtask 1.2: Ensure entity has all required fields: `id`, `recruiterId`, `companyId`, `title`, `description`, `location`, `category`, `salaryMin`, `salaryMax`, `salaryCurrency`, `employmentType`, `experienceLevel`, `status`, `createdAt`, `updatedAt`. [Source: AC 2]
  - [ ] Subtask 1.3: Add JPA annotations for entity mapping and relationships. [Source: architecture/11-backend-architecture.md]

- [ ] **Task 2: Create Database Schema for Job Postings (If Not Created in Story 1.3) (AC: 3)**
  - [ ] Subtask 2.1: Verify if `job_postings` table exists from Story 1.3, otherwise create migration. [Source: Story 1.3]
  - [ ] Subtask 2.2: Ensure table has all fields matching entity definition. [Source: AC 2, 3]
  - [ ] Subtask 2.3: Ensure foreign key constraints for `recruiter_id` and `company_id`. [Source: AC 3]
  - [ ] Subtask 2.4: Ensure indexes on `recruiter_id`, `company_id`, `status`, `created_at`. [Source: Performance]

- [ ] **Task 3: Create Job Posting DTOs (AC: 2, 3)**
  - [ ] Subtask 3.1: Create `CreateJobPostingDto` in backend with all required fields for job creation. [Source: AC 2]
  - [ ] Subtask 3.2: Add Jakarta validation annotations (`@NotNull`, `@NotBlank`, `@Size`, `@Min`, `@Max`) to DTO fields. [Source: architecture/15-security-and-performance.md#backend-security]
  - [ ] Subtask 3.3: Create `JobPostingDto` for API responses (includes all fields including id and timestamps). [Source: API contract]
  - [ ] Subtask 3.4: Create `UpdateJobPostingDto` for future edit functionality. [Source: Story 2.3 preparation]

- [ ] **Task 4: Implement Job Posting Service Methods (AC: 3, 4)**
  - [ ] Subtask 4.1: Update or create `JobService` in `apps/api/src/main/java/com/recruitify/service/JobService.java`. [Source: architecture/11-backend-architecture.md]
  - [ ] Subtask 4.2: Implement `createJobPosting(userId, companyId, CreateJobPostingDto)` method. [Source: AC 3]
  - [ ] Subtask 4.3: Verify user is RECRUITER and owns the company before creating job. [Source: Security + AC 3]
  - [ ] Subtask 4.4: Set default `status = 'ACTIVE'` for new job postings. [Source: AC 4]
  - [ ] Subtask 4.5: Set `recruiterId` and `companyId` from authenticated user context. [Source: AC 3]
  - [ ] Subtask 4.6: Validate salary range (salaryMin <= salaryMax if both provided). [Source: Business logic]

- [ ] **Task 5: Create Job Posting Controller and API Endpoint (AC: 1, 3, 4)**
  - [ ] Subtask 5.1: Update or create `JobController` in `apps/api/src/main/java/com/recruitify/controller/JobController.java`. [Source: architecture/11-backend-architecture.md]
  - [ ] Subtask 5.2: Implement `POST /api/v1/jobs` endpoint (authenticated, RECRUITER role only). [Source: AC 1, 3]
  - [ ] Subtask 5.3: Extract user ID from JWT to link job to employer. [Source: AC 3]
  - [ ] Subtask 5.4: Return 201 Created with full `JobPostingDto` on success. [Source: REST best practices]
  - [ ] Subtask 5.5: Return 400 Bad Request for validation errors, 403 Forbidden for non-recruiters. [Source: REST best practices]
  - [ ] Subtask 5.6: Add `@PreAuthorize("hasRole('RECRUITER')")` annotation. [Source: Story 2.1 RBAC patterns]

- [ ] **Task 6: Create Shared TypeScript Types for Job Posting (AC: 2)**
  - [ ] Subtask 6.1: Update or create `packages/shared-types/job.ts` with comprehensive types. [Source: architecture/17-coding-standards.md]
  - [ ] Subtask 6.2: Define `CreateJobPostingDto` interface matching backend DTO. [Source: AC 2]
  - [ ] Subtask 6.3: Define `JobPosting` interface for full job object with all fields. [Source: AC 3]
  - [ ] Subtask 6.4: Add type for `JobCategory` enum and `EmploymentType` enum. [Source: AC 2]

- [ ] **Task 7: Create Frontend Job Posting Service (AC: 1, 3)**
  - [ ] Subtask 7.1: Update or create `apps/web/src/services/jobService.ts`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 7.2: Implement `createJobPosting(data: CreateJobPostingDto)` function calling `POST /api/v1/jobs`. [Source: AC 3]
  - [ ] Subtask 7.3: Ensure function uses authenticated `apiClient` with JWT token. [Source: architecture/10-frontend-architecture.md#api-client-setup]

- [ ] **Task 8: Create Job Posting Form Component (AC: 2)**
  - [ ] Subtask 8.1: Create `apps/web/src/features/employer/JobPostingForm.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 8.2: Add form fields: Job Title (required), Location (required), Category (required, dropdown), Employment Type (required, dropdown), Experience Level (required, dropdown). [Source: AC 2]
  - [ ] Subtask 8.3: Add form fields: Salary Range (optional, Min & Max inputs with Currency dropdown), Description (required, rich text editor or textarea). [Source: AC 2]
  - [ ] Subtask 8.4: Use Ant Design `Form`, `Input`, `Select`, `InputNumber`, `Input.TextArea` components. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 8.5: Add form validation: required fields, salary range validation, max length constraints. [Source: AC 2]
  - [ ] Subtask 8.6: Add loading state and error handling for form submission. [Source: UX best practice]
  - [ ] Subtask 8.7: Show success message and redirect to dashboard after successful submission. [Source: UX flow]

- [ ] **Task 9: Create "Post a New Job" Page (AC: 1)**
  - [ ] Subtask 9.1: Create `apps/web/src/pages/employer/post-job.tsx` route for `/employer/post-job`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 9.2: Page displays `JobPostingForm` component with clear title "Post a New Job". [Source: AC 1]
  - [ ] Subtask 9.3: Add route guard to ensure only authenticated RECRUITER users can access. [Source: Story 2.1 RBAC]
  - [ ] Subtask 9.4: On form submission, call `jobService.createJobPosting()` and handle response. [Source: AC 3]
  - [ ] Subtask 9.5: On success, show toast notification and redirect to `/employer/dashboard`. [Source: UX flow]

- [ ] **Task 10: Add "Post Job" Button to Employer Dashboard (AC: 1)**
  - [ ] Subtask 10.1: Update employer dashboard page (from Story 2.3, or create placeholder if not exists). [Source: AC 1]
  - [ ] Subtask 10.2: Add prominent "Post a New Job" button in dashboard header. [Source: AC 1]
  - [ ] Subtask 10.3: Button navigates to `/employer/post-job` route. [Source: AC 1]
  - [ ] Subtask 10.4: Use Ant Design `Button` component with primary styling. [Source: architecture/3-tech-stack.md]

- [ ] **Task 11: Update Main Navigation for Employers (AC: 1)**
  - [ ] Subtask 11.1: Update main navigation component to include "Post Job" link for RECRUITER users. [Source: Story 2.1 role-based nav]
  - [ ] Subtask 11.2: Ensure "Post Job" link is only visible to authenticated recruiters. [Source: Story 2.1 RBAC]

- [ ] **Task 12: Verify New Job Appears in Public Listings (AC: 4)**
  - [ ] Subtask 12.1: Verify that jobs with `status = 'ACTIVE'` are fetched by `GET /api/v1/jobs` endpoint from Story 1.3. [Source: AC 4]
  - [ ] Subtask 12.2: Test that newly created job appears on `/jobs` page immediately after creation. [Source: AC 4]
  - [ ] Subtask 12.3: Verify new job displays correct company name, title, location from public listings. [Source: AC 4]

- [ ] **Task 13: Implement Backend Unit Tests (AC: 3, 4)**
  - [ ] Subtask 13.1: Write unit test for `JobService.createJobPosting()` to verify job creation. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 13.2: Write unit test to verify salary range validation (min <= max). [Source: Business logic]
  - [ ] Subtask 13.3: Write unit test to verify default status is set to 'ACTIVE'. [Source: AC 4]
  - [ ] Subtask 13.4: Write unit test to verify only RECRUITER can create jobs. [Source: RBAC]
  - [ ] Subtask 13.5: Place tests in `apps/api/src/test/java/com/recruitify/service/JobServiceTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 14: Implement Backend Integration Tests (AC: 3, 4)**
  - [ ] Subtask 14.1: Write integration test for `POST /api/v1/jobs` endpoint (full request/response). [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 14.2: Verify 201 Created response with correct job data. [Source: AC 3]
  - [ ] Subtask 14.3: Verify 403 Forbidden when JOB_SEEKER tries to create job. [Source: RBAC]
  - [ ] Subtask 14.4: Verify 400 Bad Request for invalid data (missing required fields, invalid salary range). [Source: Validation]
  - [ ] Subtask 14.5: Verify created job is linked to correct recruiter and company. [Source: AC 3]
  - [ ] Subtask 14.6: Place tests in `apps/api/src/test/java/com/recruitify/controller/JobControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 15: Implement Frontend Component Tests (AC: 2)**
  - [ ] Subtask 15.1: Write unit test for `JobPostingForm` to verify all form fields render correctly. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 15.2: Write unit test to verify form validation (required fields). [Source: AC 2]
  - [ ] Subtask 15.3: Write unit test for successful form submission. [Source: AC 2]
  - [ ] Subtask 15.4: Place test co-located: `JobPostingForm.test.tsx`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 16: Implement E2E Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 16.1: Create Playwright E2E test for employer creating a new job posting. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.2: Test navigating to "Post Job" page from dashboard. [Source: AC 1]
  - [ ] Subtask 16.3: Test filling out complete job posting form with all fields. [Source: AC 2]
  - [ ] Subtask 16.4: Test successful submission and redirect to dashboard. [Source: AC 3]
  - [ ] Subtask 16.5: Test newly created job appears on public `/jobs` page. [Source: AC 4]
  - [ ] Subtask 16.6: Test JOB_SEEKER cannot access "Post Job" page (403 or redirect). [Source: RBAC]
  - [ ] Subtask 16.7: Place tests in `e2e/employer-job-posting.spec.ts`. [Source: architecture/16-testing-strategy.md]

**Dev Notes**

**Previous Story Dependencies**: This story depends on:
- **Story 1.3** (View Job Listings): The `JobPosting` entity and `job_postings` table may have been created in Story 1.3. If so, verify the schema matches requirements for this story (especially new fields like `employmentType`, `experienceLevel`). If not created, this story must create them.
- **Story 2.1** (Employer Registration): The role-based authorization system, `Company` entity, and employer authentication flow must be complete. Employers must have company profiles before creating job postings.

**Database Schema Considerations**: Story 1.3 created a basic `JobPosting` model for **viewing** jobs, but Story 2.2 introduces the **creation** flow. Additional fields may be needed:
- `employmentType`: 'FULL_TIME' | 'PART_TIME' | 'CONTRACT' | 'INTERNSHIP'
- `experienceLevel`: 'ENTRY' | 'MID' | 'SENIOR' | 'LEAD' | 'EXECUTIVE'
- Verify if these fields exist in Story 1.3 schema, otherwise add them via migration.

**Data Models**:

*   **JobPosting Model (Enhanced)**:
    *   `id`: `string` (UUID) - Primary key
    *   `recruiterId`: `string` (UUID, FK to User) - The recruiter who posted the job
    *   `companyId`: `string` (UUID, FK to Company) - The company posting the job
    *   `title`: `string` - Job title (required, max 255 chars)
    *   `description`: `string` - Full job description (required, max 5000 chars)
    *   `location`: `string` - Job location (required, max 255 chars)
    *   `category`: `string` - Job category (required, e.g., "Engineering", "Marketing", "Sales")
    *   `employmentType`: `'FULL_TIME' | 'PART_TIME' | 'CONTRACT' | 'INTERNSHIP'` - Employment type (required)
    *   `experienceLevel`: `'ENTRY' | 'MID' | 'SENIOR' | 'LEAD' | 'EXECUTIVE'` - Experience level (required)
    *   `salaryMin`: `number` - Minimum salary (optional)
    *   `salaryMax`: `number` - Maximum salary (optional)
    *   `salaryCurrency`: `string` - Currency code (default: "USD")
    *   `status`: `'ACTIVE' | 'INACTIVE' | 'CLOSED'` - Job posting status (default: ACTIVE)
    *   `createdAt`: `Date` - When job was posted
    *   `updatedAt`: `Date` - Last modification timestamp
    *   [Source: Story 1.3 base model + AC 2 requirements]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/job.ts
export type JobCategory =
  | 'Engineering'
  | 'Product'
  | 'Design'
  | 'Marketing'
  | 'Sales'
  | 'Operations'
  | 'Finance'
  | 'HR'
  | 'Customer Support'
  | 'Other';

export type EmploymentType =
  | 'FULL_TIME'
  | 'PART_TIME'
  | 'CONTRACT'
  | 'INTERNSHIP';

export type ExperienceLevel =
  | 'ENTRY'
  | 'MID'
  | 'SENIOR'
  | 'LEAD'
  | 'EXECUTIVE';

export type JobStatus = 'ACTIVE' | 'INACTIVE' | 'CLOSED';

export interface CreateJobPostingDto {
  title: string;
  description: string;
  location: string;
  category: JobCategory;
  employmentType: EmploymentType;
  experienceLevel: ExperienceLevel;
  salaryMin?: number;
  salaryMax?: number;
  salaryCurrency?: string;  // default: 'USD'
}

export interface JobPosting {
  id: string;
  recruiterId: string;
  companyId: string;
  companyName: string;  // Denormalized for display
  title: string;
  description: string;
  location: string;
  category: JobCategory;
  employmentType: EmploymentType;
  experienceLevel: ExperienceLevel;
  salaryMin?: number;
  salaryMax?: number;
  salaryCurrency: string;
  status: JobStatus;
  createdAt: Date;
  updatedAt: Date;
}
```

**API Specifications**:

*   **POST /api/v1/jobs**:
    *   Creates a new job posting
    *   Requires authentication + RECRUITER role
    *   Request body: `CreateJobPostingDto`
    *   Returns 201 Created with `JobPosting` object
    *   Returns 400 Bad Request for validation errors (missing required fields, salaryMin > salaryMax)
    *   Returns 403 Forbidden if user is not RECRUITER or doesn't own a company
    *   Automatically sets `recruiterId` from JWT, `companyId` from user's company, `status = 'ACTIVE'`
    *   [Source: AC 1, 2, 3, 4]

**Database Schema Updates** (if not in Story 1.3):

```sql
-- Update job_postings table (if new fields needed)
ALTER TABLE job_postings
ADD COLUMN employment_type VARCHAR(50) NOT NULL CHECK (employment_type IN ('FULL_TIME', 'PART_TIME', 'CONTRACT', 'INTERNSHIP')),
ADD COLUMN experience_level VARCHAR(50) NOT NULL CHECK (experience_level IN ('ENTRY', 'MID', 'SENIOR', 'LEAD', 'EXECUTIVE'));

-- Or if table doesn't exist yet, create complete schema
CREATE TABLE job_postings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    recruiter_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    location VARCHAR(255) NOT NULL,
    category VARCHAR(100) NOT NULL,
    employment_type VARCHAR(50) NOT NULL CHECK (employment_type IN ('FULL_TIME', 'PART_TIME', 'CONTRACT', 'INTERNSHIP')),
    experience_level VARCHAR(50) NOT NULL CHECK (experience_level IN ('ENTRY', 'MID', 'SENIOR', 'LEAD', 'EXECUTIVE')),
    salary_min DECIMAL(10, 2),
    salary_max DECIMAL(10, 2),
    salary_currency VARCHAR(3) DEFAULT 'USD',
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'INACTIVE', 'CLOSED')),
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Indexes (if not already created)
CREATE INDEX idx_job_postings_recruiter ON job_postings (recruiter_id);
CREATE INDEX idx_job_postings_company ON job_postings (company_id);
CREATE INDEX idx_job_postings_status ON job_postings (status);
CREATE INDEX idx_job_postings_created_at ON job_postings (created_at DESC);
CREATE INDEX idx_job_postings_category ON job_postings (category);
CREATE INDEX idx_job_postings_location ON job_postings (location);
```
[Source: Story 1.3 base schema + AC 2 requirements]

**Component Specifications**:

*   **JobPostingForm**: Comprehensive form component with multiple field types:
    *   Text inputs: Title, Location
    *   Dropdowns (Select): Category, Employment Type, Experience Level, Currency
    *   Number inputs: Salary Min, Salary Max
    *   Textarea: Description (consider using rich text editor for better UX)
    *   Uses Ant Design `Form` with layout="vertical" for clarity
    *   Implements real-time validation feedback
    *   [Source: architecture/10-frontend-architecture.md and AC 2]

**File Locations**:

*   **Backend**:
    *   Entity: `apps/api/src/main/java/com/recruitify/entities/JobPosting.java` (update if exists)
    *   Repository: `apps/api/src/main/java/com/recruitify/repository/JobPostingRepository.java` (update if exists)
    *   Service: `apps/api/src/main/java/com/recruitify/service/JobService.java` (update if exists)
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/JobController.java` (update if exists)
    *   DTOs: `apps/api/src/main/java/com/recruitify/dto/CreateJobPostingDto.java`, `JobPostingDto.java`
    *   Database Migration: `apps/api/src/main/resources/db/migration/V4__add_job_posting_fields.sql` (or create V3 if not exists)

*   **Frontend**:
    *   Pages: `apps/web/src/pages/employer/post-job.tsx` (new)
    *   Components: `apps/web/src/features/employer/JobPostingForm.tsx` (new)
    *   Services: `apps/web/src/services/jobService.ts` (update from Story 1.3)
    *   Updated: `apps/web/src/pages/employer/dashboard.tsx` (add "Post Job" button)

*   **Shared Types**: `packages/shared-types/job.ts` (update from Story 1.3)

**Testing Requirements**:

*   **Unit Tests:**
    *   Backend: Test `JobService.createJobPosting()`, salary validation, status defaults
    *   Frontend: Test `JobPostingForm` component, field validation
    *   [Source: architecture/16-testing-strategy.md]

*   **Integration Tests:**
    *   Backend: Test `POST /api/v1/jobs` endpoint with various scenarios (valid data, invalid data, wrong role)
    *   Verify job is linked to correct company and recruiter
    *   [Source: architecture/16-testing-strategy.md]

*   **E2E Tests:**
    *   Complete flow: Login as employer → Navigate to Post Job → Fill form → Submit → Verify job appears in public listings
    *   [Source: architecture/16-testing-strategy.md]

**Technical Constraints**:

*   **Company Required**: Employer must have a company profile (from Story 2.1) before creating jobs. Validate this in backend service. [Source: AC 3]
*   **Salary Validation**: If both salaryMin and salaryMax are provided, ensure salaryMin <= salaryMax. [Source: Business logic]
*   **Default Values**: Set `status = 'ACTIVE'` and `salaryCurrency = 'USD'` by default. [Source: AC 4 and common practice]
*   **Authorization**: Verify employer owns the company before creating job. [Source: Security]
*   **Input Validation**:
    *   Title: max 255 chars, required
    *   Description: max 5000 chars, required
    *   Location: max 255 chars, required
    *   Category, EmploymentType, ExperienceLevel: must be from predefined enums
    *   [Source: architecture/15-security-and-performance.md]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `JobPostingForm.tsx`)
*   Java classes: `PascalCase` (e.g., `CreateJobPostingDto.java`)
*   API endpoints: `kebab-case` (e.g., `/api/v1/jobs`)
*   Database tables: `snake_case` (e.g., `job_postings`)
*   Database columns: `snake_case` (e.g., `employment_type`, `experience_level`)
*   [Source: architecture/17-coding-standards.md]

**Security Considerations**:

*   **RBAC Enforcement**: Only RECRUITER role can create jobs. Use `@PreAuthorize("hasRole('RECRUITER')")`. [Source: Story 2.1 patterns]
*   **Ownership Verification**: Verify employer owns the company being associated with the job. [Source: Security best practice]
*   **Input Sanitization**: Sanitize job description to prevent XSS attacks (especially if using rich text editor). [Source: architecture/15-security-and-performance.md]
*   **SQL Injection Prevention**: Use JPA/Hibernate parameterized queries (automatic). [Source: architecture/15-security-and-performance.md]

**UX Considerations**:

*   **Form Autosave**: Consider saving form as draft to prevent data loss (future enhancement). [Source: UX best practice]
*   **Success Feedback**: Show clear success message after job creation with link to view the job. [Source: UX best practice]
*   **Preview Mode**: Consider adding "Preview" button to see how job will appear to job seekers (future enhancement). [Source: UX best practice]
*   **Salary Optional**: Make salary fields optional to accommodate employers who prefer not to disclose compensation. [Source: AC 2 - "necessary fields" implies some flexibility]
*   **Category Suggestions**: Provide predefined list of common job categories in dropdown. [Source: Data consistency]

**Future Enhancements** (Not in MVP):
*   Rich text editor for job description (formatting, bullet points)
*   Job posting templates for common roles
*   Draft/scheduled publishing
*   Job posting analytics (views, applications)
*   Duplicate existing job feature

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 2, Story 2.2 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
