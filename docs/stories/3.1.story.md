# Story 3.1: Job Seeker "My Applications" Page

**Status**: Draft

**Story**

As a logged-in job seeker,
I want a page where I can see all the jobs I have applied for and their status,
so that I can track my job search progress in one place.

**Acceptance Criteria**

1. A logged-in job seeker can navigate to a "My Applications" page via their profile or a main navigation link.
2. The page displays a list of all jobs the user has applied to.
3. Each item in the list shows the job title, company name, the date the application was submitted, and the application's current status (e.g., "Applied," "Under Review").
4. The backend provides a secure API endpoint to fetch the application history for the currently logged-in user.

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend API to Fetch User's Application History (AC: 2, 4)**
  - [ ] Subtask 1.1: Add method to `ApplicationService`: `getMyApplications(userId)`. [Source: AC 2, 4]
  - [ ] Subtask 1.2: Use `ApplicationRepository.findByJobSeekerId(userId)` from Story 2.4. [Source: Story 2.4 repository]
  - [ ] Subtask 1.3: Sort applications by `appliedAt DESC` (newest first). [Source: UX best practice]
  - [ ] Subtask 1.4: Join with JobPosting and Company to get job title and company name. [Source: AC 3]
  - [ ] Subtask 1.5: Map to `MyApplicationDto` that includes job details. [Source: AC 3]

- [ ] **Task 2: Create MyApplicationDto (AC: 3)**
  - [ ] Subtask 2.1: Create `MyApplicationDto` with fields: `applicationId`, `jobId`, `jobTitle`, `companyName`, `appliedAt`, `status`, `location`, `employmentType`. [Source: AC 3]
  - [ ] Subtask 2.2: Include job-related fields for quick reference without additional API calls. [Source: Performance]
  - [ ] Subtask 2.3: Map internal status to user-friendly display status (prepare for Story 3.4). [Source: Story 3.4 AC 3]

- [ ] **Task 3: Create Application History Endpoint (AC: 1, 2, 4)**
  - [ ] Subtask 3.1: Update `ApplicationController` with job seeker-facing endpoint. [Source: architecture/11-backend-architecture.md]
  - [ ] Subtask 3.2: Implement `GET /api/v1/applications/my-applications` (authenticated, JOB_SEEKER only). [Source: AC 1, 4]
  - [ ] Subtask 3.3: Endpoint returns `List<MyApplicationDto>`. [Source: AC 2, 3]
  - [ ] Subtask 3.4: Add `@PreAuthorize("hasRole('JOB_SEEKER')")` annotation. [Source: Story 2.1 RBAC patterns]
  - [ ] Subtask 3.5: Extract user ID from JWT to fetch their applications. [Source: AC 4 - security]
  - [ ] Subtask 3.6: Return 200 OK with application list (empty array if no applications). [Source: REST best practices]

- [ ] **Task 4: Create Shared TypeScript Types for Application History (AC: 3)**
  - [ ] Subtask 4.1: Update `packages/shared-types/application.ts` with job seeker view types. [Source: architecture/17-coding-standards.md]
  - [ ] Subtask 4.2: Define `MyApplication` interface matching backend DTO. [Source: AC 3]
  - [ ] Subtask 4.3: Define `ApplicationStatusDisplay` type for user-friendly status labels. [Source: Story 3.4 preparation]

- [ ] **Task 5: Create Frontend Application History Service (AC: 2, 4)**
  - [ ] Subtask 5.1: Update `apps/web/src/services/applicationService.ts` with job seeker methods. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 5.2: Implement `getMyApplications()` function calling `GET /api/v1/applications/my-applications`. [Source: AC 2, 4]
  - [ ] Subtask 5.3: Ensure function uses authenticated `apiClient` with JWT token. [Source: Security]

- [ ] **Task 6: Create Application History Store (AC: 2)**
  - [ ] Subtask 6.1: Create `apps/web/src/stores/useMyApplicationsStore.ts` for application history state. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 6.2: Store `applications` array, `isLoading`, `error`. [Source: State management]
  - [ ] Subtask 6.3: Create async action `fetchMyApplications()` that calls application service. [Source: AC 2]
  - [ ] Subtask 6.4: Add action to refresh applications list after status changes (Story 3.4 integration). [Source: Future integration]

- [ ] **Task 7: Create Application History Card Component (AC: 3)**
  - [ ] Subtask 7.1: Create `apps/web/src/features/applications/ApplicationCard.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 7.2: Card displays: Job Title (clickable link to job details), Company Name, Applied Date (relative + full date), Status Badge. [Source: AC 3]
  - [ ] Subtask 7.3: Include Location and Employment Type as secondary info. [Source: Context]
  - [ ] Subtask 7.4: Use Ant Design `Card`, `Badge`, `Tag` components. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 7.5: Color-code status badges: blue (New/Applied), yellow (Under Review), green (Interview), gray (Closed). [Source: Visual feedback]
  - [ ] Subtask 7.6: Add "View Job" button that links to job details page. [Source: Navigation]
  - [ ] Subtask 7.7: Show relative time format (e.g., "Applied 3 days ago"). [Source: UX best practice]

- [ ] **Task 8: Create Application History List Component (AC: 2, 3)**
  - [ ] Subtask 8.1: Create `apps/web/src/features/applications/ApplicationsList.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 8.2: Display grid/list of `ApplicationCard` components. [Source: AC 2]
  - [ ] Subtask 8.3: Use Ant Design `List` component with responsive grid. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 8.4: Add loading state using `Skeleton` components. [Source: UX best practice]
  - [ ] Subtask 8.5: Add empty state: "You haven't applied to any jobs yet. Start exploring opportunities!" with link to jobs page. [Source: UX best practice]
  - [ ] Subtask 8.6: Add filter tabs: "All", "Active", "Closed" to filter applications by status. [Source: Management UX]
  - [ ] Subtask 8.7: Add search/filter by job title or company name. [Source: Usability]

- [ ] **Task 9: Create "My Applications" Page (AC: 1, 2, 3)**
  - [ ] Subtask 9.1: Create `apps/web/src/pages/applications/index.tsx` route for `/applications`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 9.2: Add route guard to ensure only authenticated JOB_SEEKER users can access. [Source: Story 2.1 RBAC]
  - [ ] Subtask 9.3: Page header with "My Applications" title and summary stats (Total Applications, Active, etc.). [Source: Dashboard UX]
  - [ ] Subtask 9.4: Fetch applications on page load using `useMyApplicationsStore`. [Source: AC 2]
  - [ ] Subtask 9.5: Display `ApplicationsList` component with fetched data. [Source: AC 2, 3]
  - [ ] Subtask 9.6: Handle error states gracefully. [Source: Error handling]

- [ ] **Task 10: Add Navigation Link to "My Applications" (AC: 1)**
  - [ ] Subtask 10.1: Update main navigation component to include "My Applications" link for JOB_SEEKER users. [Source: AC 1]
  - [ ] Subtask 10.2: Add "My Applications" link to user profile dropdown menu. [Source: AC 1]
  - [ ] Subtask 10.3: Link navigates to `/applications` route. [Source: AC 1]
  - [ ] Subtask 10.4: Show notification badge with count of new/unread applications (future enhancement). [Source: Engagement]
  - [ ] Subtask 10.5: Ensure link is only visible to authenticated JOB_SEEKER users. [Source: RBAC]

- [ ] **Task 11: Add Quick Access from Job Details Page (UX Enhancement)**
  - [ ] Subtask 11.1: Update job details page to show "View in My Applications" link if user has applied. [Source: Navigation UX]
  - [ ] Subtask 11.2: Link scrolls or highlights the specific application in the list. [Source: Context awareness]

- [ ] **Task 12: Create Summary Statistics Component (AC: 2)**
  - [ ] Subtask 12.1: Create `apps/web/src/features/applications/ApplicationsStats.tsx` component. [Source: Dashboard UX]
  - [ ] Subtask 12.2: Display cards/stats: Total Applications, Active Applications, Interview Stage, Closed Applications. [Source: Insights]
  - [ ] Subtask 12.3: Use Ant Design `Statistic` component. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 12.4: Calculate stats from applications array in store. [Source: Client-side computation]

- [ ] **Task 13: Implement Status Mapping for Display (Story 3.4 Preparation)**
  - [ ] Subtask 13.1: Create utility function `mapApplicationStatus(internalStatus)` to convert to display status. [Source: Story 3.4 AC 3]
  - [ ] Subtask 13.2: Mapping: 'NEW' → 'Applied', 'UNDER_REVIEW' → 'Under Review', 'INTERVIEW' → 'In Progress', 'CLOSED' → 'Closed'. [Source: Story 3.4 AC 3]
  - [ ] Subtask 13.3: Use mapped status in UI components. [Source: User-friendly labels]

- [ ] **Task 14: Implement Backend Unit Tests (AC: 4)**
  - [ ] Subtask 14.1: Write unit test for `ApplicationService.getMyApplications()` to verify fetching user's applications. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 14.2: Write unit test to verify applications are sorted by date (newest first). [Source: AC 2]
  - [ ] Subtask 14.3: Write unit test to verify job details are included in response. [Source: AC 3]
  - [ ] Subtask 14.4: Place tests in `apps/api/src/test/java/com/recruitify/service/ApplicationServiceTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 15: Implement Backend Integration Tests (AC: 1, 4)**
  - [ ] Subtask 15.1: Write integration test for `GET /api/v1/applications/my-applications` endpoint. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 15.2: Verify 200 OK response with correct application data. [Source: AC 2, 3]
  - [ ] Subtask 15.3: Verify authenticated user only sees their own applications (not other users'). [Source: AC 4 - security]
  - [ ] Subtask 15.4: Verify 401 Unauthorized when not authenticated. [Source: Security]
  - [ ] Subtask 15.5: Verify 403 Forbidden when RECRUITER tries to access this endpoint. [Source: RBAC]
  - [ ] Subtask 15.6: Verify empty array returned when user has no applications. [Source: Edge case]
  - [ ] Subtask 15.7: Place tests in `apps/api/src/test/java/com/recruitify/controller/ApplicationControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 16: Implement Frontend Component Tests (AC: 2, 3)**
  - [ ] Subtask 16.1: Write unit test for `ApplicationCard` to verify it displays all required info. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.2: Write unit test for `ApplicationsList` to verify it renders multiple cards. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.3: Write unit test for empty state when no applications. [Source: UX coverage]
  - [ ] Subtask 16.4: Write unit test for status badge color coding. [Source: Visual feedback]
  - [ ] Subtask 16.5: Place tests co-located: `ApplicationCard.test.tsx`, `ApplicationsList.test.tsx`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 17: Implement E2E Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 17.1: Create Playwright E2E test for job seeker viewing their application history. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 17.2: Test navigating to "My Applications" page from main navigation. [Source: AC 1]
  - [ ] Subtask 17.3: Test page displays all applications user has submitted. [Source: AC 2]
  - [ ] Subtask 17.4: Test each application shows job title, company, date, and status. [Source: AC 3]
  - [ ] Subtask 17.5: Test clicking job title navigates to job details page. [Source: Navigation]
  - [ ] Subtask 17.6: Test empty state when user has no applications. [Source: Edge case]
  - [ ] Subtask 17.7: Test RECRUITER cannot access "My Applications" page. [Source: RBAC]
  - [ ] Subtask 17.8: Test unauthenticated user is redirected to login. [Source: Security]
  - [ ] Subtask 17.9: Place tests in `e2e/job-seeker-applications.spec.ts`. [Source: architecture/16-testing-strategy.md]

**Dev Notes**

**Previous Story Dependencies**: This story depends on:
- **Story 1.2** (Registration & Login): Authentication system for JOB_SEEKER users
- **Story 2.4** (Apply for Job): The `Application` entity and application submission flow must be complete. This story uses the `ApplicationRepository.findByJobSeekerId()` method created in Story 2.4.

This story completes the job seeker's view of their application journey, providing transparency into their job search progress.

**Data Security**: This story implements the job seeker side of application data access. Key security principle: Job seekers can ONLY see their own applications, never other users' applications. The user ID is extracted from the JWT, not from request parameters, to prevent unauthorized access.

**Data Models**:

*   **MyApplication (New DTO for Job Seeker View)**:
    *   `applicationId`: `string` (UUID)
    *   `jobId`: `string` (UUID)
    *   `jobTitle`: `string`
    *   `companyName`: `string`
    *   `location`: `string`
    *   `employmentType`: `EmploymentType`
    *   `appliedAt`: `Date`
    *   `status`: `ApplicationStatus` (internal) or `ApplicationStatusDisplay` (mapped for UI)
    *   [Source: AC 3]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/application.ts
export type ApplicationStatusDisplay =
  | 'Applied'
  | 'Under Review'
  | 'In Progress'  // Maps to 'INTERVIEW'
  | 'Closed';

export interface MyApplication {
  applicationId: string;
  jobId: string;
  jobTitle: string;
  companyName: string;
  location: string;
  employmentType: EmploymentType;
  appliedAt: Date;
  status: ApplicationStatus;  // Internal status
  statusDisplay: ApplicationStatusDisplay;  // User-friendly status
}

export interface ApplicationsStats {
  total: number;
  active: number;  // NEW + UNDER_REVIEW + INTERVIEW
  inProgress: number;  // INTERVIEW only
  closed: number;
}
```

**Status Mapping (Story 3.4 Integration)**:
```typescript
// Utility function for status display mapping
export function mapApplicationStatus(status: ApplicationStatus): ApplicationStatusDisplay {
  const mapping: Record<ApplicationStatus, ApplicationStatusDisplay> = {
    'NEW': 'Applied',
    'UNDER_REVIEW': 'Under Review',
    'INTERVIEW': 'In Progress',
    'CLOSED': 'Closed'
  };
  return mapping[status];
}
```
[Source: Story 3.4 AC 3 - simplified user-friendly status]

**API Specifications**:

*   **GET /api/v1/applications/my-applications**:
    *   Fetches all applications for authenticated job seeker
    *   Requires authentication + JOB_SEEKER role
    *   Extracts user ID from JWT (not from request params) for security
    *   Returns 200 OK with `List<MyApplicationDto>`
    *   Returns empty array `[]` if user has no applications
    *   Returns 401 Unauthorized if not authenticated
    *   Returns 403 Forbidden if not JOB_SEEKER role
    *   Applications sorted by `appliedAt DESC` (newest first)
    *   [Source: AC 1, 2, 3, 4]

**Database Query Example**:

```java
// In ApplicationService.java
public List<MyApplicationDto> getMyApplications(UUID userId) {
    List<Application> applications = applicationRepository.findByJobSeekerId(userId);

    return applications.stream()
        .map(app -> {
            JobPosting job = app.getJobPosting();  // Assuming eager loading or JOIN FETCH
            Company company = job.getCompany();

            return MyApplicationDto.builder()
                .applicationId(app.getId())
                .jobId(job.getId())
                .jobTitle(job.getTitle())
                .companyName(company.getName())
                .location(job.getLocation())
                .employmentType(job.getEmploymentType())
                .appliedAt(app.getAppliedAt())
                .status(app.getStatus())
                .build();
        })
        .sorted(Comparator.comparing(MyApplicationDto::getAppliedAt).reversed())
        .collect(Collectors.toList());
}
```
[Source: AC 2, 3]

**Component Specifications**:

*   **ApplicationCard**: Card component for individual application. Shows job info prominently with company logo placeholder, status badge with color coding, relative time format ("Applied 3 days ago"). Click on card navigates to job details. Uses Ant Design `Card` with hover effects. [Source: architecture/10-frontend-architecture.md and AC 3]

*   **ApplicationsList**: Container component that displays grid of application cards. Uses Ant Design `List` with `grid` prop for responsive layout. Includes filter tabs for status filtering. Shows empty state with CTA to browse jobs. [Source: architecture/10-frontend-architecture.md and AC 2]

*   **ApplicationsStats**: Summary statistics component showing key metrics. Uses Ant Design `Row`/`Col` with `Statistic` components. Displays as cards above the applications list. [Source: Dashboard UX pattern]

**File Locations**:

*   **Backend**:
    *   Service: `apps/api/src/main/java/com/recruitify/service/ApplicationService.java` (update)
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/ApplicationController.java` (update)
    *   DTOs: `apps/api/src/main/java/com/recruitify/dto/MyApplicationDto.java` (new)

*   **Frontend**:
    *   Pages: `apps/web/src/pages/applications/index.tsx` (new)
    *   Components: `apps/web/src/features/applications/ApplicationCard.tsx`, `ApplicationsList.tsx`, `ApplicationsStats.tsx` (new)
    *   Services: `apps/web/src/services/applicationService.ts` (update)
    *   Stores: `apps/web/src/stores/useMyApplicationsStore.ts` (new)
    *   Utils: `apps/web/src/utils/applicationStatus.ts` (status mapping utility)

*   **Shared Types**: `packages/shared-types/application.ts` (update)

**Testing Requirements**:

*   **Unit Tests:**
    *   Backend: Test `ApplicationService.getMyApplications()`, verify sorting, verify only user's applications returned
    *   Frontend: Test application card and list components, test empty state, test status mapping
    *   [Source: architecture/16-testing-strategy.md]

*   **Integration Tests:**
    *   Backend: Test endpoint with various scenarios (has applications, no applications, wrong role, not authenticated)
    *   Critical: Verify user A cannot see user B's applications
    *   [Source: architecture/16-testing-strategy.md]

*   **E2E Tests:**
    *   Complete flow: Login as job seeker → Navigate to My Applications → View list → Click job → Navigate to job details
    *   Test empty state, test with multiple applications
    *   [Source: architecture/16-testing-strategy.md]

**Technical Constraints**:

*   **User ID from JWT**: CRITICAL - User ID MUST be extracted from JWT token, never from request parameters. This prevents unauthorized access to other users' data. [Source: Security best practice]
*   **Role Enforcement**: Only JOB_SEEKER role can access this endpoint. RECRUITER users should not see this page. [Source: Story 2.1 RBAC]
*   **Performance**: Use efficient JOIN queries to fetch job and company details with applications in single query. Avoid N+1 query problem. [Source: architecture/15-security-and-performance.md]
*   **Empty State Handling**: Return empty array `[]`, not error, when user has no applications. [Source: REST best practices]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `ApplicationCard.tsx`)
*   React hooks: `useCamelCase` (e.g., `useMyApplicationsStore.ts`)
*   Java classes: `PascalCase` (e.g., `MyApplicationDto.java`)
*   API endpoints: `kebab-case` (e.g., `/api/v1/applications/my-applications`)
*   [Source: architecture/17-coding-standards.md]

**Security Considerations**:

*   **Authorization**: User can ONLY see their own applications. User ID extracted from JWT ensures this. [Source: AC 4]
*   **SQL Injection**: Use JPA parameterized queries (automatic protection). [Source: architecture/15-security-and-performance.md]
*   **Data Exposure**: Don't include resume URLs or sensitive application details in list view (only in detail view if needed). [Source: Performance + Privacy]
*   **Cross-User Access**: Integration tests must verify user A cannot access user B's applications by any means. [Source: Security testing]

**UX Considerations**:

*   **Empty State**: First-time users see friendly empty state: "You haven't applied to any jobs yet! Start exploring opportunities." with prominent "Browse Jobs" button. [Source: Onboarding UX]
*   **Status Clarity**: Use clear, user-friendly status labels ("Applied", "Under Review", "In Progress") rather than technical labels. [Source: Story 3.4 AC 3]
*   **Date Format**: Show relative time ("Applied 3 days ago") with full date on hover for precision. [Source: Readability]
*   **Visual Hierarchy**: Use color-coded status badges for quick scanning: blue (new/applied), yellow (under review), green (interview), gray (closed). [Source: Information architecture]
*   **Quick Navigation**: Each application card is clickable and links to the full job details page. [Source: Task completion]
*   **Summary Stats**: Show key metrics at top of page (Total, Active, Closed) for quick insights into job search progress. [Source: Dashboard UX]
*   **Filter & Search**: Allow filtering by status and searching by job title/company for easier management as list grows. [Source: Usability]

**Performance Considerations**:

*   **Database Query**: Use JOIN FETCH to eagerly load JobPosting and Company in single query. Avoid N+1 problem. [Source: architecture/15-security-and-performance.md]
    ```java
    @Query("SELECT a FROM Application a " +
           "JOIN FETCH a.jobPosting jp " +
           "JOIN FETCH jp.company " +
           "WHERE a.jobSeekerId = :userId " +
           "ORDER BY a.appliedAt DESC")
    List<Application> findByJobSeekerIdWithJobDetails(@Param("userId") UUID userId);
    ```
*   **Pagination**: For MVP, load all applications. For production, implement pagination if user has >50 applications. [Source: Performance]
*   **Caching**: Consider caching application list on frontend for 5 minutes to reduce API calls. [Source: Performance]

**Accessibility Considerations**:

*   **WCAG AA Compliance**: Ensure status badges have sufficient color contrast. [Source: PRD accessibility requirement]
*   **Screen Readers**: Use proper semantic HTML and ARIA labels for status badges. [Source: Accessibility]
*   **Keyboard Navigation**: Ensure all application cards are keyboard accessible. [Source: WCAG AA]

**Integration with Story 3.4**: This story sets up the infrastructure for Story 3.4 (Application Status Visibility):
1. Status display mapping function is created
2. Applications page will auto-refresh or update when status changes
3. Status badge component prepared for real-time updates (future: websockets)

**Future Enhancements** (Not in MVP):
*   Real-time status updates via websockets or polling
*   Email notifications when application status changes
*   Application withdrawal feature
*   Export applications list to PDF/CSV
*   Advanced filtering (by date range, location, company)
*   Application notes feature
*   Save job search searches/filters

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 3, Story 3.1 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
