# Story 2.3: Employer Job Management Dashboard

**Status**: Draft

**Story**

As a logged-in employer,
I want a dashboard where I can see and manage all the jobs I've posted,
so that I can maintain a clear view of my active listings.

**Acceptance Criteria**

1. A logged-in employer has a dedicated "Dashboard" page.
2. The dashboard displays a list of all jobs posted by that employer.
3. Each job in the list displays its title, status (e.g., Active, Inactive), and a count of applicants.
4. The employer can perform basic management actions from the dashboard, such as editing or deactivating a job post.

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend API to Fetch Employer's Jobs (AC: 2)**
  - [ ] Subtask 1.1: Add method to `JobPostingRepository`: `List<JobPosting> findByRecruiterId(UUID recruiterId)`. [Source: AC 2]
  - [ ] Subtask 1.2: Add method to `JobService`: `getMyJobs(userId)` that fetches all jobs for the authenticated recruiter. [Source: AC 2]
  - [ ] Subtask 1.3: Add sorting by `createdAt DESC` to show newest jobs first. [Source: UX best practice]
  - [ ] Subtask 1.4: Method should return jobs with all statuses (ACTIVE, INACTIVE, CLOSED) for dashboard management. [Source: AC 3]

- [ ] **Task 2: Create JobSummaryDto with Applicant Count (AC: 3)**
  - [ ] Subtask 2.1: Create `JobSummaryDto` in backend with fields: `id`, `title`, `status`, `applicantCount`, `createdAt`, `location`, `employmentType`. [Source: AC 3]
  - [ ] Subtask 2.2: Add query to count applicants per job (prepare for Story 2.4/2.5 integration). [Source: AC 3]
  - [ ] Subtask 2.3: For now, set `applicantCount = 0` as placeholder until applications feature is built in Story 2.4. [Source: Story dependency]

- [ ] **Task 3: Create Dashboard API Endpoint (AC: 1, 2, 3)**
  - [ ] Subtask 3.1: Add `GET /api/v1/jobs/my-jobs` endpoint to `JobController` (authenticated, RECRUITER only). [Source: AC 1, 2]
  - [ ] Subtask 3.2: Endpoint returns `List<JobSummaryDto>` with all jobs for authenticated recruiter. [Source: AC 2, 3]
  - [ ] Subtask 3.3: Add `@PreAuthorize("hasRole('RECRUITER')")` annotation. [Source: Story 2.1 RBAC patterns]
  - [ ] Subtask 3.4: Extract recruiter ID from JWT to fetch their jobs. [Source: Security]

- [ ] **Task 4: Create Job Deactivation Endpoint (AC: 4)**
  - [ ] Subtask 4.1: Add method to `JobService`: `deactivateJob(jobId, userId)` that sets `status = 'INACTIVE'`. [Source: AC 4]
  - [ ] Subtask 4.2: Verify job ownership before deactivating (userId must match recruiterId). [Source: Security]
  - [ ] Subtask 4.3: Add `PATCH /api/v1/jobs/{id}/deactivate` endpoint to `JobController`. [Source: AC 4]
  - [ ] Subtask 4.4: Add `PATCH /api/v1/jobs/{id}/activate` endpoint for reactivating jobs. [Source: Management flexibility]
  - [ ] Subtask 4.5: Return updated `JobSummaryDto` after status change. [Source: REST best practices]

- [ ] **Task 5: Create Job Update Endpoint (AC: 4)**
  - [ ] Subtask 5.1: Add method to `JobService`: `updateJob(jobId, userId, UpdateJobPostingDto)`. [Source: AC 4]
  - [ ] Subtask 5.2: Verify job ownership before updating (userId must match recruiterId). [Source: Security]
  - [ ] Subtask 5.3: Add `PUT /api/v1/jobs/{id}` endpoint to `JobController` (authenticated, RECRUITER only). [Source: AC 4]
  - [ ] Subtask 5.4: Return updated `JobPosting` object. [Source: REST best practices]
  - [ ] Subtask 5.5: Add validation for update DTO (same rules as create). [Source: Data integrity]

- [ ] **Task 6: Create Shared TypeScript Types for Dashboard (AC: 3)**
  - [ ] Subtask 6.1: Create `JobSummary` interface in `packages/shared-types/job.ts`. [Source: architecture/17-coding-standards.md]
  - [ ] Subtask 6.2: Define fields: `id`, `title`, `status`, `applicantCount`, `createdAt`, `location`, `employmentType`. [Source: AC 3]
  - [ ] Subtask 6.3: Create `UpdateJobPostingDto` interface for edit functionality. [Source: AC 4]

- [ ] **Task 7: Create Frontend Dashboard Service (AC: 1, 2)**
  - [ ] Subtask 7.1: Update `apps/web/src/services/jobService.ts` with dashboard methods. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 7.2: Implement `getMyJobs()` function calling `GET /api/v1/jobs/my-jobs`. [Source: AC 2]
  - [ ] Subtask 7.3: Implement `deactivateJob(id)` function calling `PATCH /api/v1/jobs/{id}/deactivate`. [Source: AC 4]
  - [ ] Subtask 7.4: Implement `activateJob(id)` function calling `PATCH /api/v1/jobs/{id}/activate`. [Source: AC 4]
  - [ ] Subtask 7.5: Implement `updateJob(id, data)` function calling `PUT /api/v1/jobs/{id}`. [Source: AC 4]

- [ ] **Task 8: Create Dashboard Store with Zustand (AC: 2, 3)**
  - [ ] Subtask 8.1: Create `apps/web/src/stores/useDashboardStore.ts` for employer dashboard state. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 8.2: Store `myJobs` array, `isLoading`, `error`. [Source: State management]
  - [ ] Subtask 8.3: Create async action `fetchMyJobs()` that calls `jobService.getMyJobs()`. [Source: AC 2]
  - [ ] Subtask 8.4: Create action `toggleJobStatus(id)` that calls deactivate/activate service. [Source: AC 4]

- [ ] **Task 9: Create Job Summary Card Component (AC: 3)**
  - [ ] Subtask 9.1: Create `apps/web/src/features/employer/JobSummaryCard.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 9.2: Card displays: Job Title, Status badge (Active/Inactive), Applicant count with icon, Location, Employment Type, Created date. [Source: AC 3]
  - [ ] Subtask 9.3: Use Ant Design `Card`, `Badge`, `Statistic` components. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 9.4: Add action buttons: "View Applicants" (navigates to applicants page), "Edit", "Deactivate/Activate", "View Public". [Source: AC 4]
  - [ ] Subtask 9.5: Use different color coding for status: green (Active), gray (Inactive), red (Closed). [Source: UX best practice]

- [ ] **Task 10: Create Dashboard Jobs List Component (AC: 2, 3)**
  - [ ] Subtask 10.1: Create `apps/web/src/features/employer/DashboardJobsList.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 10.2: Display grid/list of `JobSummaryCard` components. [Source: AC 2]
  - [ ] Subtask 10.3: Use Ant Design `List` component with responsive grid. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 10.4: Add loading state using `Skeleton` components. [Source: UX best practice]
  - [ ] Subtask 10.5: Add empty state with "Post Your First Job" CTA when no jobs exist. [Source: UX best practice]
  - [ ] Subtask 10.6: Add filter tabs: "All Jobs", "Active", "Inactive", "Closed". [Source: Management UX]

- [ ] **Task 11: Create Employer Dashboard Page (AC: 1, 2, 3, 4)**
  - [ ] Subtask 11.1: Create `apps/web/src/pages/employer/dashboard.tsx` route for `/employer/dashboard`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 11.2: Add route guard to ensure only authenticated RECRUITER users can access. [Source: Story 2.1 RBAC]
  - [ ] Subtask 11.3: Page header with "My Jobs" title and "Post New Job" button. [Source: AC 1]
  - [ ] Subtask 11.4: Display summary statistics: Total Jobs, Active Jobs, Total Applicants. [Source: Dashboard UX]
  - [ ] Subtask 11.5: Use `useDashboardStore` to fetch and display jobs on mount. [Source: AC 2]
  - [ ] Subtask 11.6: Pass jobs data to `DashboardJobsList` component. [Source: AC 2, 3]
  - [ ] Subtask 11.7: Handle job status toggle (activate/deactivate) actions. [Source: AC 4]

- [ ] **Task 12: Create Job Edit Modal/Page (AC: 4)**
  - [ ] Subtask 12.1: Create `apps/web/src/features/employer/JobEditModal.tsx` or separate edit page. [Source: AC 4]
  - [ ] Subtask 12.2: Reuse `JobPostingForm` component from Story 2.2 with edit mode. [Source: Code reuse]
  - [ ] Subtask 12.3: Pre-populate form with existing job data. [Source: AC 4]
  - [ ] Subtask 12.4: On submit, call `jobService.updateJob()` and refresh dashboard. [Source: AC 4]
  - [ ] Subtask 12.5: Show success message after update. [Source: UX feedback]

- [ ] **Task 13: Update Main Navigation (AC: 1)**
  - [ ] Subtask 13.1: Ensure "Dashboard" link is prominently displayed for RECRUITER users in main nav. [Source: AC 1]
  - [ ] Subtask 13.2: Make "Dashboard" the default landing page after employer login. [Source: Story 2.1 login flow]

- [ ] **Task 14: Implement Backend Unit Tests (AC: 2, 3, 4)**
  - [ ] Subtask 14.1: Write unit test for `JobService.getMyJobs()` to verify fetching recruiter's jobs. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 14.2: Write unit test for `JobService.deactivateJob()` with ownership verification. [Source: AC 4 + Security]
  - [ ] Subtask 14.3: Write unit test for `JobService.updateJob()` with ownership verification. [Source: AC 4 + Security]
  - [ ] Subtask 14.4: Write unit test to verify recruiter cannot deactivate/edit other recruiter's jobs. [Source: Security]
  - [ ] Subtask 14.5: Place tests in `apps/api/src/test/java/com/recruitify/service/JobServiceTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 15: Implement Backend Integration Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 15.1: Write integration test for `GET /api/v1/jobs/my-jobs` endpoint. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 15.2: Write integration test for `PATCH /api/v1/jobs/{id}/deactivate` endpoint. [Source: AC 4]
  - [ ] Subtask 15.3: Write integration test for `PUT /api/v1/jobs/{id}` endpoint. [Source: AC 4]
  - [ ] Subtask 15.4: Verify 403 Forbidden when trying to edit/deactivate another recruiter's job. [Source: Security]
  - [ ] Subtask 15.5: Verify 403 Forbidden when JOB_SEEKER tries to access dashboard endpoints. [Source: RBAC]
  - [ ] Subtask 15.6: Place tests in `apps/api/src/test/java/com/recruitify/controller/JobControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 16: Implement Frontend Component Tests (AC: 2, 3)**
  - [ ] Subtask 16.1: Write unit test for `JobSummaryCard` to verify it renders all job info. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.2: Write unit test for `DashboardJobsList` to verify it renders multiple cards. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.3: Write unit test for empty state when no jobs exist. [Source: UX coverage]
  - [ ] Subtask 16.4: Place tests co-located: `JobSummaryCard.test.tsx`, `DashboardJobsList.test.tsx`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 17: Implement E2E Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 17.1: Create Playwright E2E test for employer accessing dashboard after login. [Source: AC 1]
  - [ ] Subtask 17.2: Test dashboard displays all posted jobs with correct info (title, status, applicant count). [Source: AC 2, 3]
  - [ ] Subtask 17.3: Test deactivating a job and verifying status changes to "Inactive". [Source: AC 4]
  - [ ] Subtask 17.4: Test editing a job and verifying changes are saved. [Source: AC 4]
  - [ ] Subtask 17.5: Test reactivating an inactive job. [Source: Management flow]
  - [ ] Subtask 17.6: Test JOB_SEEKER cannot access employer dashboard (403 or redirect). [Source: RBAC]
  - [ ] Subtask 17.7: Place tests in `e2e/employer-dashboard.spec.ts`. [Source: architecture/16-testing-strategy.md]

**Dev Notes**

**Previous Story Dependencies**: This story depends on:
- **Story 2.1** (Employer Registration): Role-based authentication, employer accounts, company profiles.
- **Story 2.2** (Create Job Posting): The `JobPosting` entity, job creation flow, and job data structure.
- **Story 2.4** (Apply for Job - partial dependency): The `applicantCount` field in AC 3 requires the applications system from Story 2.4. For this story, we'll display `applicantCount = 0` as a placeholder until applications are implemented.

**Applicant Count Implementation**: AC 3 requires displaying "a count of applicants" for each job. However, the applications system is introduced in Story 2.4. **Resolution**:
1. Add `applicantCount` field to `JobSummaryDto` now
2. Set it to 0 for all jobs in this story
3. In Story 2.4/2.5, update the query to count actual applications

This approach allows Story 2.3 to be completed without blocking on Story 2.4.

**Data Models**:

*   **JobSummary (New DTO for Dashboard)**:
    *   `id`: `string` (UUID)
    *   `title`: `string`
    *   `status`: `'ACTIVE' | 'INACTIVE' | 'CLOSED'`
    *   `applicantCount`: `number` (set to 0 until Story 2.4)
    *   `createdAt`: `Date`
    *   `location`: `string`
    *   `employmentType`: `EmploymentType`
    *   [Source: AC 3]

*   **UpdateJobPostingDto**:
    *   Same as `CreateJobPostingDto` but all fields are optional
    *   Allows partial updates to job postings
    *   [Source: AC 4]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/job.ts
export interface JobSummary {
  id: string;
  title: string;
  status: JobStatus;
  applicantCount: number;  // Will be 0 until Story 2.4
  createdAt: Date;
  location: string;
  employmentType: EmploymentType;
}

export interface UpdateJobPostingDto {
  title?: string;
  description?: string;
  location?: string;
  category?: JobCategory;
  employmentType?: EmploymentType;
  experienceLevel?: ExperienceLevel;
  salaryMin?: number;
  salaryMax?: number;
  salaryCurrency?: string;
}
```

**API Specifications**:

*   **GET /api/v1/jobs/my-jobs**:
    *   Fetches all jobs posted by authenticated recruiter
    *   Requires authentication + RECRUITER role
    *   Returns 200 OK with `List<JobSummary>`
    *   Returns 403 Forbidden if not RECRUITER
    *   Sorted by `createdAt DESC` (newest first)
    *   [Source: AC 1, 2, 3]

*   **PATCH /api/v1/jobs/{id}/deactivate**:
    *   Sets job status to 'INACTIVE'
    *   Requires authentication + RECRUITER role + ownership
    *   Returns 200 OK with updated `JobSummary`
    *   Returns 403 Forbidden if not owner
    *   Returns 404 Not Found if job doesn't exist
    *   [Source: AC 4]

*   **PATCH /api/v1/jobs/{id}/activate**:
    *   Sets job status to 'ACTIVE'
    *   Requires authentication + RECRUITER role + ownership
    *   Returns 200 OK with updated `JobSummary`
    *   [Source: Management flexibility]

*   **PUT /api/v1/jobs/{id}**:
    *   Updates job posting details
    *   Requires authentication + RECRUITER role + ownership
    *   Request body: `UpdateJobPostingDto` (partial update)
    *   Returns 200 OK with updated `JobPosting`
    *   Returns 400 Bad Request for validation errors
    *   Returns 403 Forbidden if not owner
    *   [Source: AC 4]

**Component Specifications**:

*   **JobSummaryCard**: Card component displaying job summary info with action buttons. Uses Ant Design `Card` with `Meta` for content and `Badge` for status. Action buttons use `Dropdown` menu or inline buttons. [Source: architecture/10-frontend-architecture.md and AC 3, 4]

*   **DashboardJobsList**: List container component that displays grid of job cards. Uses Ant Design `List` with responsive grid (`grid={{ gutter: 16, xs: 1, sm: 2, lg: 3 }}`). Includes filter tabs using `Tabs` component. [Source: architecture/10-frontend-architecture.md and AC 2]

**File Locations**:

*   **Backend**:
    *   Service: `apps/api/src/main/java/com/recruitify/service/JobService.java` (update)
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/JobController.java` (update)
    *   Repository: `apps/api/src/main/java/com/recruitify/repository/JobPostingRepository.java` (update)
    *   DTOs: `apps/api/src/main/java/com/recruitify/dto/JobSummaryDto.java`, `UpdateJobPostingDto.java`

*   **Frontend**:
    *   Pages: `apps/web/src/pages/employer/dashboard.tsx` (new)
    *   Components: `apps/web/src/features/employer/JobSummaryCard.tsx`, `DashboardJobsList.tsx`, `JobEditModal.tsx` (new)
    *   Services: `apps/web/src/services/jobService.ts` (update)
    *   Stores: `apps/web/src/stores/useDashboardStore.ts` (new)

*   **Shared Types**: `packages/shared-types/job.ts` (update)

**Testing Requirements**:

*   **Unit Tests:**
    *   Backend: Test all new `JobService` methods (getMyJobs, deactivateJob, updateJob) with ownership verification
    *   Frontend: Test dashboard components (JobSummaryCard, DashboardJobsList) and empty state
    *   [Source: architecture/16-testing-strategy.md]

*   **Integration Tests:**
    *   Backend: Test all new endpoints with various auth scenarios (owner, non-owner, wrong role)
    *   [Source: architecture/16-testing-strategy.md]

*   **E2E Tests:**
    *   Complete dashboard flow: Login → View dashboard → Deactivate job → Edit job → View updated status
    *   [Source: architecture/16-testing-strategy.md]

**Technical Constraints**:

*   **Ownership Verification**: All job management actions (edit, deactivate, activate) must verify the authenticated recruiter owns the job. [Source: Security]
*   **RBAC Enforcement**: All dashboard endpoints must check for RECRUITER role. [Source: Story 2.1 patterns]
*   **Status Transitions**: Document valid status transitions (e.g., can only activate INACTIVE jobs, not CLOSED jobs). [Source: Business logic]
*   **Applicant Count Query**: Prepare database query structure for counting applicants (will be implemented in Story 2.4/2.5). [Source: AC 3]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `DashboardJobsList.tsx`)
*   React hooks: `useCamelCase` (e.g., `useDashboardStore.ts`)
*   Java classes: `PascalCase` (e.g., `JobSummaryDto.java`)
*   API endpoints: `kebab-case` (e.g., `/api/v1/jobs/my-jobs`)
*   [Source: architecture/17-coding-standards.md]

**Security Considerations**:

*   **Job Ownership**: Always verify `job.recruiterId === authenticatedUser.id` before allowing updates or status changes. [Source: Security best practice]
*   **Cross-Recruiter Access**: Ensure one recruiter cannot view, edit, or manage another recruiter's jobs. [Source: Security best practice]
*   **Authorization Checks**: Perform authorization checks in service layer, not just in controller. [Source: Defense in depth]

**UX Considerations**:

*   **Dashboard Overview**: Provide summary statistics at top (Total Jobs, Active, Total Applicants) for quick insights. [Source: Dashboard UX best practice]
*   **Empty State**: When employer has no jobs, show engaging empty state with "Post Your First Job" CTA. [Source: Onboarding UX]
*   **Filter Tabs**: Allow filtering by status (All, Active, Inactive, Closed) for easier management. [Source: Management UX]
*   **Status Visual Feedback**: Use color coding and badges for job status (green=Active, gray=Inactive, red=Closed). [Source: Visual hierarchy]
*   **Quick Actions**: Provide quick action buttons on each job card (View Applicants, Edit, Toggle Status). [Source: Efficiency]
*   **Confirmation Modals**: Show confirmation modal before deactivating a job to prevent accidental actions. [Source: Error prevention]

**Performance Considerations**:

*   **Query Optimization**: Add index on `recruiter_id` for fast job lookup (should exist from Story 1.3/2.2). [Source: architecture/15-security-and-performance.md]
*   **Applicant Count**: When Story 2.4/2.5 implements applications, optimize the count query using database aggregation rather than loading all applications. [Source: Performance]

**Future Enhancements** (Not in MVP):
*   Pagination for dashboards with many jobs
*   Bulk actions (deactivate multiple jobs at once)
*   Job performance metrics (views per job, application rate)
*   Export job listings as CSV
*   Job duplication feature

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 2, Story 2.3 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
