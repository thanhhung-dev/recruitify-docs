# Story 2.5: View Job Applicants

**Status**: Draft

**Story**

As a logged-in employer,
I want to view a list of applicants for each of my jobs,
so that I can begin the candidate review process.

**Acceptance Criteria**

1. From the employer dashboard, clicking on a specific job posting navigates to a page listing all applicants for that role.
2. The applicant list displays the name of each candidate and the date they applied.
3. The employer can click on an individual applicant to view the details they submitted with their application (e.g., view their profile, download their resume).
4. The backend provides a secure API endpoint for an employer to retrieve applicants only for jobs they own.

**Tasks / Subtasks**

- [ ] **Task 1: Create Backend API to Fetch Job Applicants (AC: 1, 2, 4)**
  - [ ] Subtask 1.1: Add method to `ApplicationService`: `getApplicantsForJob(jobId, recruiterId)`. [Source: AC 4]
  - [ ] Subtask 1.2: Verify job ownership before returning applicants (recruiterId must match job's recruiterId). [Source: AC 4 - security]
  - [ ] Subtask 1.3: Use `ApplicationRepository.findByJobPostingId(jobId)` to fetch applications. [Source: Story 2.4 repository]
  - [ ] Subtask 1.4: Sort applicants by `appliedAt DESC` (newest applications first). [Source: UX best practice]
  - [ ] Subtask 1.5: Map `Application` entities to `ApplicantSummaryDto` for list view. [Source: API design]

- [ ] **Task 2: Create ApplicantSummaryDto (AC: 2)**
  - [ ] Subtask 2.1: Create `ApplicantSummaryDto` with fields: `id`, `firstName`, `lastName`, `email`, `appliedAt`, `status`. [Source: AC 2]
  - [ ] Subtask 2.2: Exclude sensitive fields like `resumeUrl` from summary (only in detail view). [Source: Performance + API design]
  - [ ] Subtask 2.3: Include full name as computed field: `fullName = firstName + lastName`. [Source: Display convenience]

- [ ] **Task 3: Create Applicant Detail Endpoint (AC: 3)**
  - [ ] Subtask 3.1: Add method to `ApplicationService`: `getApplicationDetail(applicationId, recruiterId)`. [Source: AC 3]
  - [ ] Subtask 3.2: Verify recruiter owns the job before returning application details. [Source: AC 4 - security]
  - [ ] Subtask 3.3: Return full `ApplicationDto` including `resumeUrl`, `coverLetter`, all contact info. [Source: AC 3]

- [ ] **Task 4: Create Resume Download/Access Endpoint (AC: 3)**
  - [ ] Subtask 4.1: Add method to `FileStorageService`: `generateSignedResumeUrl(resumeKey, expirationMinutes)`. [Source: AC 3]
  - [ ] Subtask 4.2: Generate time-limited signed URL for S3 resume access (expires in 60 minutes). [Source: Security]
  - [ ] Subtask 4.3: Add endpoint `GET /api/v1/applications/{id}/resume-url` that returns signed URL. [Source: AC 3]
  - [ ] Subtask 4.4: Verify recruiter owns the job before generating resume URL. [Source: AC 4 - security]

- [ ] **Task 5: Create Application Controller Endpoints (AC: 1, 2, 3, 4)**
  - [ ] Subtask 5.1: Update `ApplicationController` with employer-facing endpoints. [Source: architecture/11-backend-architecture.md]
  - [ ] Subtask 5.2: Implement `GET /api/v1/jobs/{jobId}/applicants` (authenticated, RECRUITER only). [Source: AC 1, 2]
  - [ ] Subtask 5.3: Endpoint returns `List<ApplicantSummaryDto>`. [Source: AC 2]
  - [ ] Subtask 5.4: Implement `GET /api/v1/applications/{id}` for full application detail. [Source: AC 3]
  - [ ] Subtask 5.5: Implement `GET /api/v1/applications/{id}/resume-url` for signed resume download URL. [Source: AC 3]
  - [ ] Subtask 5.6: Add `@PreAuthorize("hasRole('RECRUITER')")` to all employer endpoints. [Source: Story 2.1 RBAC]
  - [ ] Subtask 5.7: Return 403 Forbidden if recruiter doesn't own the job. [Source: AC 4]
  - [ ] Subtask 5.8: Return 404 Not Found if job or application doesn't exist. [Source: REST best practices]

- [ ] **Task 6: Create Shared TypeScript Types for Applicants (AC: 2, 3)**
  - [ ] Subtask 6.1: Update `packages/shared-types/application.ts` with applicant view types. [Source: architecture/17-coding-standards.md]
  - [ ] Subtask 6.2: Define `ApplicantSummary` interface for list view. [Source: AC 2]
  - [ ] Subtask 6.3: Define `ApplicationDetail` interface for detail view (extends Application). [Source: AC 3]
  - [ ] Subtask 6.4: Define `ResumeUrlResponse` interface with signed URL and expiration. [Source: AC 3]

- [ ] **Task 7: Create Frontend Applicants Service (AC: 1, 2, 3)**
  - [ ] Subtask 7.1: Create `apps/web/src/services/applicantService.ts` using authenticated `apiClient`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 7.2: Implement `getApplicantsForJob(jobId)` function calling `GET /api/v1/jobs/{jobId}/applicants`. [Source: AC 1, 2]
  - [ ] Subtask 7.3: Implement `getApplicationDetail(applicationId)` function calling `GET /api/v1/applications/{id}`. [Source: AC 3]
  - [ ] Subtask 7.4: Implement `getResumeDownloadUrl(applicationId)` function calling `GET /api/v1/applications/{id}/resume-url`. [Source: AC 3]

- [ ] **Task 8: Create Applicant List Component (AC: 2)**
  - [ ] Subtask 8.1: Create `apps/web/src/features/employer/ApplicantsList.tsx` component. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 8.2: Display list/table of applicants with columns: Name, Email, Applied Date, Status, Actions. [Source: AC 2]
  - [ ] Subtask 8.3: Use Ant Design `Table` component with sorting and filtering. [Source: architecture/3-tech-stack.md]
  - [ ] Subtask 8.4: Add "View Details" button/link in Actions column. [Source: AC 3]
  - [ ] Subtask 8.5: Show loading state using `Skeleton` component. [Source: UX best practice]
  - [ ] Subtask 8.6: Show empty state with message when no applicants yet: "No applications received yet". [Source: UX best practice]
  - [ ] Subtask 8.7: Add filter options: All, New, Under Review, Interview, Closed. [Source: Management UX]

- [ ] **Task 9: Create Applicant Detail Modal/Page (AC: 3)**
  - [ ] Subtask 9.1: Create `apps/web/src/features/employer/ApplicantDetailModal.tsx` or separate page. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 9.2: Display full application details: Name, Email, Phone, Cover Letter, Applied Date, Current Status. [Source: AC 3]
  - [ ] Subtask 9.3: Add "Download Resume" button that fetches signed URL and opens in new tab. [Source: AC 3]
  - [ ] Subtask 9.4: Add "View Resume" button that displays PDF inline if possible (using iframe or PDF viewer). [Source: UX enhancement]
  - [ ] Subtask 9.5: Display applicant's profile information if available (prepare for future integration). [Source: AC 3]
  - [ ] Subtask 9.6: Add status change dropdown (prepare for Story 3.3). [Source: Future integration]

- [ ] **Task 10: Create Job Applicants Page (AC: 1, 2)**
  - [ ] Subtask 10.1: Create `apps/web/src/pages/employer/jobs/[id]/applicants.tsx` route for `/employer/jobs/{id}/applicants`. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 10.2: Add route guard to ensure only authenticated RECRUITER can access. [Source: Story 2.1 RBAC]
  - [ ] Subtask 10.3: Page header displays job title and total applicant count. [Source: Context]
  - [ ] Subtask 10.4: Fetch applicants on page load using `applicantService.getApplicantsForJob(jobId)`. [Source: AC 1]
  - [ ] Subtask 10.5: Display `ApplicantsList` component with fetched data. [Source: AC 2]
  - [ ] Subtask 10.6: Handle click on applicant to open detail modal. [Source: AC 3]

- [ ] **Task 11: Update Dashboard to Link to Applicants Page (AC: 1)**
  - [ ] Subtask 11.1: Update `JobSummaryCard` from Story 2.3 to make applicant count clickable. [Source: AC 1]
  - [ ] Subtask 11.2: Clicking applicant count navigates to `/employer/jobs/{id}/applicants`. [Source: AC 1]
  - [ ] Subtask 11.3: Add "View Applicants" button in card actions dropdown. [Source: AC 1]
  - [ ] Subtask 11.4: Show visual indication if there are new (unreviewed) applications. [Source: UX enhancement]

- [ ] **Task 12: Create Applicants Store with Zustand (AC: 1, 2)**
  - [ ] Subtask 12.1: Create `apps/web/src/stores/useApplicantsStore.ts` for applicants state. [Source: architecture/10-frontend-architecture.md]
  - [ ] Subtask 12.2: Store `applicants` array, `selectedApplication`, `isLoading`, `error`. [Source: State management]
  - [ ] Subtask 12.3: Create async action `fetchApplicants(jobId)` that calls applicant service. [Source: AC 1]
  - [ ] Subtask 12.4: Create action `selectApplicant(id)` to load detail view. [Source: AC 3]

- [ ] **Task 13: Handle Resume Download Flow (AC: 3)**
  - [ ] Subtask 13.1: When "Download Resume" is clicked, call `getResumeDownloadUrl(applicationId)`. [Source: AC 3]
  - [ ] Subtask 13.2: Open signed URL in new browser tab to trigger download. [Source: AC 3]
  - [ ] Subtask 13.3: Show loading state while fetching signed URL. [Source: UX feedback]
  - [ ] Subtask 13.4: Handle errors gracefully (e.g., "Resume no longer available"). [Source: Error handling]

- [ ] **Task 14: Implement Backend Unit Tests (AC: 4)**
  - [ ] Subtask 14.1: Write unit test for `ApplicationService.getApplicantsForJob()` with ownership verification. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 14.2: Write unit test to verify recruiter cannot access other recruiter's applicants. [Source: AC 4 - security]
  - [ ] Subtask 14.3: Write unit test for `ApplicationService.getApplicationDetail()` with ownership check. [Source: AC 3, 4]
  - [ ] Subtask 14.4: Write unit test for signed URL generation. [Source: AC 3]
  - [ ] Subtask 14.5: Place tests in `apps/api/src/test/java/com/recruitify/service/ApplicationServiceTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 15: Implement Backend Integration Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 15.1: Write integration test for `GET /api/v1/jobs/{jobId}/applicants` endpoint. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 15.2: Verify 200 OK response with correct applicant data. [Source: AC 2]
  - [ ] Subtask 15.3: Verify 403 Forbidden when recruiter tries to access another recruiter's job applicants. [Source: AC 4]
  - [ ] Subtask 15.4: Write integration test for `GET /api/v1/applications/{id}` endpoint. [Source: AC 3]
  - [ ] Subtask 15.5: Write integration test for `GET /api/v1/applications/{id}/resume-url` endpoint. [Source: AC 3]
  - [ ] Subtask 15.6: Verify JOB_SEEKER cannot access employer applicant endpoints. [Source: RBAC]
  - [ ] Subtask 15.7: Place tests in `apps/api/src/test/java/com/recruitify/controller/ApplicationControllerIntegrationTest.java`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 16: Implement Frontend Component Tests (AC: 2, 3)**
  - [ ] Subtask 16.1: Write unit test for `ApplicantsList` to verify table renders with applicant data. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 16.2: Write unit test for empty state when no applicants. [Source: UX coverage]
  - [ ] Subtask 16.3: Write unit test for `ApplicantDetailModal` rendering all application details. [Source: AC 3]
  - [ ] Subtask 16.4: Place tests co-located: `ApplicantsList.test.tsx`, `ApplicantDetailModal.test.tsx`. [Source: architecture/16-testing-strategy.md]

- [ ] **Task 17: Implement E2E Tests (AC: 1, 2, 3, 4)**
  - [ ] Subtask 17.1: Create Playwright E2E test for employer viewing job applicants. [Source: architecture/16-testing-strategy.md]
  - [ ] Subtask 17.2: Test navigating from dashboard to applicants page by clicking job. [Source: AC 1]
  - [ ] Subtask 17.3: Test applicant list displays names and applied dates correctly. [Source: AC 2]
  - [ ] Subtask 17.4: Test clicking an applicant opens detail modal with full information. [Source: AC 3]
  - [ ] Subtask 17.5: Test downloading resume successfully opens in new tab. [Source: AC 3]
  - [ ] Subtask 17.6: Test employer cannot access applicants for jobs they don't own (403). [Source: AC 4]
  - [ ] Subtask 17.7: Test JOB_SEEKER cannot access applicants pages. [Source: RBAC]
  - [ ] Subtask 17.8: Place tests in `e2e/employer-applicants.spec.ts`. [Source: architecture/16-testing-strategy.md]

**Dev Notes**

**Previous Story Dependencies**: This story depends on:
- **Story 2.2** (Create Job Posting): Job postings must exist to have applicants
- **Story 2.3** (Employer Dashboard): The dashboard is the entry point for viewing applicants (AC 1)
- **Story 2.4** (Apply for Job): The `Application` entity and application submission flow must be complete

This story completes Epic 2 by connecting employers to their applicants, enabling the core hiring workflow.

**Security Architecture**: This story implements critical security measures for protecting candidate data:
1. **Ownership Verification**: Every applicant access must verify the recruiter owns the associated job
2. **Signed URLs**: Resumes accessed via time-limited S3 signed URLs (60-minute expiration)
3. **Role-Based Access**: Only RECRUITER role can access applicant endpoints
4. **No Cross-Recruiter Access**: Recruiter A cannot see Recruiter B's applicants

**Data Models**:

*   **ApplicantSummary (New DTO for List View)**:
    *   `id`: `string` (application ID)
    *   `firstName`: `string`
    *   `lastName`: `string`
    *   `fullName`: `string` (computed: firstName + lastName)
    *   `email`: `string`
    *   `appliedAt`: `Date`
    *   `status`: `ApplicationStatus`
    *   [Source: AC 2]

*   **ApplicationDetail (Full Application View)**:
    *   All fields from `Application` model (Story 2.4)
    *   Used for detail modal/page (AC 3)
    *   [Source: AC 3]

**TypeScript Interfaces**:

```typescript
// In packages/shared-types/application.ts
export interface ApplicantSummary {
  id: string;
  firstName: string;
  lastName: string;
  fullName: string;
  email: string;
  appliedAt: Date;
  status: ApplicationStatus;
}

export interface ApplicationDetail extends Application {
  // Inherits all fields from Application
  // Used for detailed view with resume access
}

export interface ResumeUrlResponse {
  url: string;
  expiresAt: Date;
  filename: string;
}
```

**API Specifications**:

*   **GET /api/v1/jobs/{jobId}/applicants**:
    *   Fetches all applicants for a specific job
    *   Requires authentication + RECRUITER role
    *   Verifies recruiter owns the job (jobPosting.recruiterId === authenticatedUser.id)
    *   Returns 200 OK with `List<ApplicantSummary>`
    *   Returns 403 Forbidden if not job owner
    *   Returns 404 Not Found if job doesn't exist
    *   Sorted by `appliedAt DESC`
    *   [Source: AC 1, 2, 4]

*   **GET /api/v1/applications/{id}**:
    *   Fetches full details of a specific application
    *   Requires authentication + RECRUITER role
    *   Verifies recruiter owns the job associated with application
    *   Returns 200 OK with `ApplicationDetail`
    *   Returns 403 Forbidden if not job owner
    *   Returns 404 Not Found if application doesn't exist
    *   [Source: AC 3, 4]

*   **GET /api/v1/applications/{id}/resume-url**:
    *   Generates time-limited signed URL for resume download
    *   Requires authentication + RECRUITER role
    *   Verifies recruiter owns the job associated with application
    *   Returns 200 OK with `ResumeUrlResponse` (URL expires in 60 minutes)
    *   Returns 403 Forbidden if not job owner
    *   Returns 404 Not Found if application or resume doesn't exist
    *   [Source: AC 3, 4]

**Component Specifications**:

*   **ApplicantsList**: Table component displaying applicants using Ant Design `Table` with sorting (by name, date), filtering (by status), and row actions. Columns: Name, Email, Applied Date (relative time + full date on hover), Status (badge with color), Actions (View Details button). [Source: architecture/10-frontend-architecture.md and AC 2]

*   **ApplicantDetailModal**: Modal or drawer component showing full application details. Uses Ant Design `Modal` or `Drawer` with sections for Contact Info, Cover Letter, Resume, and Actions (Download/View Resume, Change Status). [Source: architecture/10-frontend-architecture.md and AC 3]

**File Locations**:

*   **Backend**:
    *   Service: `apps/api/src/main/java/com/recruitify/service/ApplicationService.java` (update)
    *   Service: `apps/api/src/main/java/com/recruitify/service/FileStorageService.java` (update)
    *   Controller: `apps/api/src/main/java/com/recruitify/controller/ApplicationController.java` (update)
    *   DTOs: `apps/api/src/main/java/com/recruitify/dto/ApplicantSummaryDto.java`, `ResumeUrlResponse.java`

*   **Frontend**:
    *   Pages: `apps/web/src/pages/employer/jobs/[id]/applicants.tsx` (new)
    *   Components: `apps/web/src/features/employer/ApplicantsList.tsx`, `ApplicantDetailModal.tsx` (new)
    *   Services: `apps/web/src/services/applicantService.ts` (new)
    *   Stores: `apps/web/src/stores/useApplicantsStore.ts` (new)
    *   Updated: `apps/web/src/features/employer/JobSummaryCard.tsx` (add applicants link)

*   **Shared Types**: `packages/shared-types/application.ts` (update)

**Testing Requirements**:

*   **Unit Tests:**
    *   Backend: Test all applicant retrieval methods with ownership verification, signed URL generation
    *   Frontend: Test applicant list and detail components
    *   [Source: architecture/16-testing-strategy.md]

*   **Integration Tests:**
    *   Backend: Test all applicant endpoints with various auth scenarios (owner, non-owner, wrong role)
    *   Critical: Test cross-recruiter access prevention
    *   [Source: architecture/16-testing-strategy.md]

*   **E2E Tests:**
    *   Complete recruiter workflow: Dashboard → Click job → View applicants → Click applicant → View details → Download resume
    *   [Source: architecture/16-testing-strategy.md]

**Technical Constraints**:

*   **Ownership Verification**: CRITICAL - Every endpoint must verify job ownership before returning applicant data. This is a security requirement, not optional. [Source: AC 4]
*   **Signed URLs**: Resume URLs must expire after 60 minutes for security. Generate new signed URL each time. [Source: Security best practice]
*   **RBAC Enforcement**: Only RECRUITER role can access applicant data. [Source: Story 2.1 patterns]
*   **Privacy**: Never expose applicant data to recruiters who don't own the job. [Source: Privacy regulation compliance]

**Naming Conventions**:

*   React components: `PascalCase` (e.g., `ApplicantsList.tsx`)
*   React hooks: `useCamelCase` (e.g., `useApplicantsStore.ts`)
*   Java classes: `PascalCase` (e.g., `ApplicantSummaryDto.java`)
*   API endpoints: `kebab-case` (e.g., `/api/v1/jobs/{jobId}/applicants`)
*   [Source: architecture/17-coding-standards.md]

**Security Considerations**:

*   **Ownership Verification Layer**: Implement in service layer, not just controller. Double-check in both layers (defense in depth). [Source: Security best practice]
*   **Signed URL Expiration**: 60-minute expiration balances security and usability. Too short frustrates users, too long increases risk. [Source: Security best practice]
*   **Resume Access Logging**: Consider logging who accesses which resumes for audit trail (future enhancement). [Source: Compliance]
*   **SQL Injection**: Use JPA parameterized queries (automatic protection). [Source: architecture/15-security-and-performance.md]
*   **Authorization Errors**: Return 403 Forbidden (not 404) when recruiter tries to access unauthorized applicants to clearly indicate permission issue. [Source: REST best practices]

**UX Considerations**:

*   **Empty State**: When job has no applicants, show encouraging message: "Your job posting is live! Applicants will appear here once they apply." [Source: Positive UX]
*   **Applied Date Formatting**: Show relative time (e.g., "2 days ago") with full date on hover for context. [Source: Readability]
*   **Status Visual Coding**: Use colored badges for application status (blue=New, yellow=Under Review, green=Interview, gray=Closed). [Source: Visual hierarchy]
*   **Resume Preview**: Consider showing PDF preview inline instead of forcing download (better UX). [Source: Convenience]
*   **Sorting & Filtering**: Allow sorting by date/name and filtering by status for easier candidate management. [Source: Management efficiency]
*   **Bulk Actions**: In future, allow selecting multiple applicants for bulk status changes (not MVP). [Source: Efficiency]

**Performance Considerations**:

*   **Query Optimization**: Index on `job_posting_id` ensures fast applicant lookup (created in Story 2.4). [Source: architecture/15-security-and-performance.md]
*   **Pagination**: For jobs with many applicants (>50), implement pagination on applicants list (future enhancement). [Source: Performance]
*   **Signed URL Caching**: Don't cache signed URLs client-side since they expire. Generate fresh each time. [Source: Security]
*   **Applicant Count**: Use efficient COUNT query from Story 2.4 repository method. [Source: Performance]

**AWS S3 Signed URL Example**:

```java
// In FileStorageService.java
public String generateSignedResumeUrl(String resumeKey, int expirationMinutes) {
    Date expiration = new Date();
    long expTimeMillis = expiration.getTime();
    expTimeMillis += 1000 * 60 * expirationMinutes; // Convert minutes to milliseconds
    expiration.setTime(expTimeMillis);

    GeneratePresignedUrlRequest generatePresignedUrlRequest =
        new GeneratePresignedUrlRequest(bucketName, resumeKey)
            .withMethod(HttpMethod.GET)
            .withExpiration(expiration);

    URL url = s3Client.generatePresignedUrl(generatePresignedUrlRequest);
    return url.toString();
}
```

**Future Enhancements** (Not in MVP):
*   Email notifications when new applicant applies
*   Applicant search and advanced filtering
*   Export applicants list to CSV/Excel
*   Applicant notes and rating system
*   Automated email responses to applicants
*   Interview scheduling integration
*   Applicant pipeline stages (beyond basic status)
*   Collaborative hiring (multiple recruiters reviewing same applicants)

**Integration with Story 3.3**: This story prepares for Story 3.3 (Basic Employer Applicant Management) by:
1. Displaying current application status in the list
2. Including status in the detail view
3. Setting up the infrastructure for status changes (will be implemented in 3.3)

**Privacy Compliance Notes**:
- Resume access is logged for audit purposes
- Only job owner can access applicant data
- Time-limited access to resume files
- Consider GDPR compliance for data retention (future requirement)

**Change Log**

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-11-06 | 1.0 | Initial draft based on Epic 2, Story 2.5 | Bob (SM) |

**Dev Agent Record**

**Agent Model Used**
{{agent_model_name_version}}

**Debug Log References**

**Completion Notes List**

**File List**

**QA Results**
